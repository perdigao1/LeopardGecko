{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "This notebook show an example on how to run predictions using a pre-trained a lgsegmentor.\n",
    "\n",
    "This example it uses the validation data "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [],
   "source": [
    "import numpy as np\n",
    "import tifffile\n",
    "import napari\n",
    "import leopardgecko.segmentor as lgs\n",
    "\n",
    "import logging\n",
    "logging.basicConfig(level=logging.INFO)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Load data  for predcition and respective labels"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "data_to_pred = tifffile.imread(\"test_data/TS_0005_crop_val.tif\")\n",
    "labels_to_compare = tifffile.imread(\"test_data/TS_0005_ribos_membr_crop_val.tif\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "(256, 256, 256)\n"
     ]
    }
   ],
   "source": [
    "print(data_to_pred.shape)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Setup lg segmentor"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [],
   "source": [
    "#Create the class\n",
    "lgsegmentor0 = lgs.cMultiAxisRotationsSegmentor.create_from_model(\"2023-09-29_ribos_membr.lgsegmod\")"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Check default settings and modify as needed"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "namespace(quality='high',\n",
       "          output_probs=True,\n",
       "          clip_data=True,\n",
       "          st_dev_factor=2.575,\n",
       "          data_hdf5_path='/data',\n",
       "          cuda_device=0,\n",
       "          downsample=False,\n",
       "          one_hot=False,\n",
       "          prediction_axis='Z')"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "lgsegmentor0.NN1_pred_settings"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Set CUDA device.\n",
    "\n",
    "To change cuda device don't change with .cuda_device, but rather use setcudadevice(devnumber)\n",
    "\n",
    "You may want to check usage and memory-usage with command `!nvidia-smi` to see what is available before starting training"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Wed Oct 11 14:31:48 2023       \n",
      "+-----------------------------------------------------------------------------+\n",
      "| NVIDIA-SMI 470.57.02    Driver Version: 470.57.02    CUDA Version: 11.4     |\n",
      "|-------------------------------+----------------------+----------------------+\n",
      "| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |\n",
      "| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |\n",
      "|                               |                      |               MIG M. |\n",
      "|===============================+======================+======================|\n",
      "|   0  Tesla V100-PCIE...  On   | 00000000:00:05.0 Off |                    0 |\n",
      "| N/A   34C    P0    24W / 250W |      4MiB / 32510MiB |      0%      Default |\n",
      "|                               |                      |                  N/A |\n",
      "+-------------------------------+----------------------+----------------------+\n",
      "|   1  Tesla V100-PCIE...  On   | 00000000:00:06.0 Off |                    0 |\n",
      "| N/A   28C    P0    23W / 250W |      4MiB / 32510MiB |      0%      Default |\n",
      "|                               |                      |                  N/A |\n",
      "+-------------------------------+----------------------+----------------------+\n",
      "                                                                               \n",
      "+-----------------------------------------------------------------------------+\n",
      "| Processes:                                                                  |\n",
      "|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |\n",
      "|        ID   ID                                                   Usage      |\n",
      "|=============================================================================|\n",
      "|    0   N/A  N/A      2187      G   /usr/lib/xorg/Xorg                  4MiB |\n",
      "|    1   N/A  N/A      2187      G   /usr/lib/xorg/Xorg                  4MiB |\n",
      "+-----------------------------------------------------------------------------+\n"
     ]
    }
   ],
   "source": [
    "!nvidia-smi"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [],
   "source": [
    "lgsegmentor0.set_cuda_device(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Run the prediction and collect result"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.376452088356018\n",
      "INFO:root:Calculating standard deviation.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:Std dev: 22.28497505498702. Calculating stats.\n",
      "INFO:root:Lower bound: -54.00735867823556, upper bound: 60.7602628549476\n",
      "INFO:root:Number of voxels above upper bound to be clipped 95283 - percentage 0.568%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 175185 - percentage 1.044%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (256, 256, 256).\n",
      "Prediction batch: 100%|██████████████████████████████| 64/64 [00:02<00:00, 27.16it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (256, 256, 256, 3) to /tmp/tmphvupn0gq/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (256, 256, 256) to /tmp/tmphvupn0gq/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (256, 256, 256).\n",
      "Prediction batch: 100%|██████████████████████████████| 64/64 [00:00<00:00, 67.79it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (256, 256, 256, 3) to /tmp/tmphvupn0gq/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (256, 256, 256) to /tmp/tmphvupn0gq/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (256, 256, 256).\n",
      "Prediction batch: 100%|██████████████████████████████| 64/64 [00:01<00:00, 61.71it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (256, 256, 256, 3) to /tmp/tmphvupn0gq/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (256, 256, 256) to /tmp/tmphvupn0gq/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (256, 256, 256).\n",
      "Prediction batch: 100%|██████████████████████████████| 64/64 [00:01<00:00, 63.72it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (256, 256, 256, 3) to /tmp/tmphvupn0gq/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (256, 256, 256) to /tmp/tmphvupn0gq/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (256, 256, 256).\n",
      "Prediction batch: 100%|██████████████████████████████| 64/64 [00:01<00:00, 62.62it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (256, 256, 256, 3) to /tmp/tmphvupn0gq/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (256, 256, 256) to /tmp/tmphvupn0gq/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (256, 256, 256).\n",
      "Prediction batch: 100%|██████████████████████████████| 64/64 [00:01<00:00, 56.19it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (256, 256, 256, 3) to /tmp/tmphvupn0gq/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (256, 256, 256) to /tmp/tmphvupn0gq/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (256, 256, 256).\n",
      "Prediction batch: 100%|██████████████████████████████| 64/64 [00:00<00:00, 68.04it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (256, 256, 256, 3) to /tmp/tmphvupn0gq/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (256, 256, 256) to /tmp/tmphvupn0gq/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (256, 256, 256).\n",
      "Prediction batch: 100%|██████████████████████████████| 64/64 [00:00<00:00, 64.67it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (256, 256, 256, 3) to /tmp/tmphvupn0gq/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (256, 256, 256) to /tmp/tmphvupn0gq/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (256, 256, 256).\n",
      "Prediction batch: 100%|██████████████████████████████| 64/64 [00:01<00:00, 54.84it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (256, 256, 256, 3) to /tmp/tmphvupn0gq/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (256, 256, 256) to /tmp/tmphvupn0gq/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (256, 256, 256).\n",
      "Prediction batch: 100%|██████████████████████████████| 64/64 [00:00<00:00, 67.18it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (256, 256, 256, 3) to /tmp/tmphvupn0gq/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (256, 256, 256) to /tmp/tmphvupn0gq/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (256, 256, 256).\n",
      "Prediction batch: 100%|██████████████████████████████| 64/64 [00:01<00:00, 54.30it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (256, 256, 256, 3) to /tmp/tmphvupn0gq/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (256, 256, 256) to /tmp/tmphvupn0gq/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (256, 256, 256).\n",
      "Prediction batch: 100%|██████████████████████████████| 64/64 [00:01<00:00, 58.66it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (256, 256, 256, 3) to /tmp/tmphvupn0gq/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (256, 256, 256) to /tmp/tmphvupn0gq/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmphvupn0gq/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmphvupn0gq/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmphvupn0gq/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmphvupn0gq/pred_0_YX_90.h5   \n",
      "4    /tmp/tmphvupn0gq/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmphvupn0gq/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmphvupn0gq/pred_0_YX_180.h5   \n",
      "7   /tmp/tmphvupn0gq/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmphvupn0gq/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmphvupn0gq/pred_0_YX_270.h5   \n",
      "10  /tmp/tmphvupn0gq/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmphvupn0gq/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmphvupn0gq/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmphvupn0gq/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmphvupn0gq/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmphvupn0gq/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmphvupn0gq/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmphvupn0gq/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmphvupn0gq/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmphvupn0gq/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmphvupn0gq/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmphvupn0gq/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmphvupn0gq/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmphvupn0gq/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (256, 256, 256)  \n",
      "1           0           1  (256, 256, 256)  \n",
      "2           0           2  (256, 256, 256)  \n",
      "3          90           3  (256, 256, 256)  \n",
      "4          90           4  (256, 256, 256)  \n",
      "5          90           5  (256, 256, 256)  \n",
      "6         180           6  (256, 256, 256)  \n",
      "7         180           7  (256, 256, 256)  \n",
      "8         180           8  (256, 256, 256)  \n",
      "9         270           9  (256, 256, 256)  \n",
      "10        270          10  (256, 256, 256)  \n",
      "11        270          11  (256, 256, 256)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(256, 256, 256, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(256, 256, 256, 3), data0.chunksize:(256, 256, 256, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 256, 256, 256, 3) chunks_shape:(12, 256, 256, 256, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 377.90it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 22.92 ss\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n"
     ]
    }
   ],
   "source": [
    "pred_labels = lgsegmentor0.predict(data_to_pred)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Visualise result"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<Labels layer 'pred_labels' at 0x7ff92070beb0>"
      ]
     },
     "execution_count": 9,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import napari\n",
    "NV=napari.Viewer()\n",
    "NV.add_image(data_to_pred)\n",
    "NV.add_labels(labels_to_compare)\n",
    "NV.add_labels(pred_labels, color={1:'green'})"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Compare against ground truth\n",
    "\n",
    "Use leopardgecko metrics to get voxel-F1 (dice score)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {},
   "outputs": [],
   "source": [
    "import leopardgecko.metrics as lgm"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:MetricScoreOfVols_Dice()\n",
      "INFO:root:Number of class segmentations in first volume 3\n",
      "INFO:root:Number of class segmentations in second volume 3\n",
      "INFO:root:Calculating using numpy\n",
      "INFO:root:dicescores = {1: 0.5188051691479704, 2: 0.5507384751326172}\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "(0.5347718221402937, {1: 0.5188051691479704, 2: 0.5507384751326172})"
      ]
     },
     "execution_count": 11,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "lgm.MetricScoreOfVols_Dice(pred_labels,labels_to_compare)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Run the prediction in blocks and compare with previous result"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {},
   "outputs": [],
   "source": [
    "import leopardgecko.utils as lgu"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 0,0,0 , use origin iz00,iy00,ix00 = 0,0,0 , end iz1,iy1,ix1 = 120,120,120\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.322815972222222\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 21.626499424272946. Calculating stats.\n",
      "INFO:root:Lower bound: -52.365420045280615, upper bound: 59.01105198972506\n",
      "INFO:root:Number of voxels above upper bound to be clipped 8998 - percentage 0.521%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 18442 - percentage 1.067%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.55it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeqs7oyox/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeqs7oyox/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 100.26it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeqs7oyox/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeqs7oyox/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.75it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeqs7oyox/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeqs7oyox/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.21it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeqs7oyox/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeqs7oyox/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.76it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeqs7oyox/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeqs7oyox/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.92it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeqs7oyox/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeqs7oyox/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.88it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeqs7oyox/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeqs7oyox/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.37it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeqs7oyox/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeqs7oyox/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.17it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeqs7oyox/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeqs7oyox/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 103.16it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeqs7oyox/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeqs7oyox/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.97it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeqs7oyox/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeqs7oyox/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.38it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeqs7oyox/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeqs7oyox/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpeqs7oyox/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpeqs7oyox/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpeqs7oyox/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpeqs7oyox/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpeqs7oyox/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpeqs7oyox/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpeqs7oyox/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpeqs7oyox/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpeqs7oyox/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpeqs7oyox/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpeqs7oyox/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpeqs7oyox/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpeqs7oyox/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpeqs7oyox/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpeqs7oyox/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpeqs7oyox/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpeqs7oyox/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpeqs7oyox/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpeqs7oyox/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpeqs7oyox/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpeqs7oyox/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpeqs7oyox/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpeqs7oyox/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpeqs7oyox/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 439.40it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.33 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 0,0,0\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: First block result initialises datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 0,0,100 , use origin iz00,iy00,ix00 = 0,0,100 , end iz1,iy1,ix1 = 120,120,220\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.382552083333333\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 20.720021991082557. Calculating stats.\n",
      "INFO:root:Lower bound: -49.971504543704256, upper bound: 56.736608710370916\n",
      "INFO:root:Number of voxels above upper bound to be clipped 11218 - percentage 0.649%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 19127 - percentage 1.107%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 100.08it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmph0f7czop/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmph0f7czop/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 100.20it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmph0f7czop/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmph0f7czop/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.28it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmph0f7czop/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmph0f7czop/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.70it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmph0f7czop/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmph0f7czop/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 101.55it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmph0f7czop/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmph0f7czop/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 88.75it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmph0f7czop/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmph0f7czop/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 100.23it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmph0f7czop/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmph0f7czop/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.23it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmph0f7czop/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmph0f7czop/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.83it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmph0f7czop/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmph0f7czop/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.55it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmph0f7czop/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmph0f7czop/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.07it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmph0f7czop/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmph0f7czop/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.89it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmph0f7czop/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmph0f7czop/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmph0f7czop/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmph0f7czop/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmph0f7czop/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmph0f7czop/pred_0_YX_90.h5   \n",
      "4    /tmp/tmph0f7czop/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmph0f7czop/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmph0f7czop/pred_0_YX_180.h5   \n",
      "7   /tmp/tmph0f7czop/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmph0f7czop/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmph0f7czop/pred_0_YX_270.h5   \n",
      "10  /tmp/tmph0f7czop/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmph0f7czop/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmph0f7czop/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmph0f7czop/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmph0f7czop/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmph0f7czop/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmph0f7czop/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmph0f7czop/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmph0f7czop/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmph0f7czop/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmph0f7czop/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmph0f7czop/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmph0f7czop/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmph0f7czop/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 462.56it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.53 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 0,0,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 0,0,200 , use origin iz00,iy00,ix00 = 0,0,136 , end iz1,iy1,ix1 = 120,120,256\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.346806712962963\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 20.454237638503237. Calculating stats.\n",
      "INFO:root:Lower bound: -49.32285520618287, upper bound: 56.016468632108804\n",
      "INFO:root:Number of voxels above upper bound to be clipped 10388 - percentage 0.601%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 17535 - percentage 1.015%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 89.87it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp824mraak/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp824mraak/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.75it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp824mraak/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp824mraak/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.17it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp824mraak/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp824mraak/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 102.34it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp824mraak/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp824mraak/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.19it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp824mraak/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp824mraak/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 84.90it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp824mraak/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp824mraak/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 89.47it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp824mraak/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp824mraak/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.06it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp824mraak/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp824mraak/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.87it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp824mraak/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp824mraak/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.82it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp824mraak/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp824mraak/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.31it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp824mraak/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp824mraak/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.74it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp824mraak/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp824mraak/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmp824mraak/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmp824mraak/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmp824mraak/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmp824mraak/pred_0_YX_90.h5   \n",
      "4    /tmp/tmp824mraak/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmp824mraak/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmp824mraak/pred_0_YX_180.h5   \n",
      "7   /tmp/tmp824mraak/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmp824mraak/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmp824mraak/pred_0_YX_270.h5   \n",
      "10  /tmp/tmp824mraak/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmp824mraak/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmp824mraak/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmp824mraak/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmp824mraak/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmp824mraak/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmp824mraak/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmp824mraak/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmp824mraak/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmp824mraak/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmp824mraak/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmp824mraak/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmp824mraak/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmp824mraak/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 492.48it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.54 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 0,0,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 0,56,0 , use origin iz00,iy00,ix00 = 0,56,0 , end iz1,iy1,ix1 = 120,176,120\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.3996261574074076\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 22.662450008097117. Calculating stats.\n",
      "INFO:root:Lower bound: -54.95618261344268, upper bound: 61.755434928257486\n",
      "INFO:root:Number of voxels above upper bound to be clipped 8914 - percentage 0.516%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 19505 - percentage 1.129%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.19it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpiu2kw7yf/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpiu2kw7yf/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.57it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpiu2kw7yf/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpiu2kw7yf/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.61it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpiu2kw7yf/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpiu2kw7yf/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.54it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpiu2kw7yf/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpiu2kw7yf/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 89.56it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpiu2kw7yf/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpiu2kw7yf/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 83.36it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpiu2kw7yf/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpiu2kw7yf/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 89.13it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpiu2kw7yf/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpiu2kw7yf/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 83.86it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpiu2kw7yf/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpiu2kw7yf/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 82.32it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpiu2kw7yf/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpiu2kw7yf/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 78.41it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpiu2kw7yf/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpiu2kw7yf/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 89.89it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpiu2kw7yf/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpiu2kw7yf/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 84.50it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpiu2kw7yf/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpiu2kw7yf/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpiu2kw7yf/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpiu2kw7yf/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpiu2kw7yf/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpiu2kw7yf/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpiu2kw7yf/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpiu2kw7yf/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpiu2kw7yf/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpiu2kw7yf/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpiu2kw7yf/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpiu2kw7yf/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpiu2kw7yf/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpiu2kw7yf/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpiu2kw7yf/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpiu2kw7yf/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpiu2kw7yf/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpiu2kw7yf/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpiu2kw7yf/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpiu2kw7yf/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpiu2kw7yf/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpiu2kw7yf/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpiu2kw7yf/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpiu2kw7yf/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpiu2kw7yf/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpiu2kw7yf/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 444.28it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.64 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 0,32,0\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 0,56,100 , use origin iz00,iy00,ix00 = 0,56,100 , end iz1,iy1,ix1 = 120,176,220\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.4469172453703703\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 21.62629107789812. Calculating stats.\n",
      "INFO:root:Lower bound: -52.24078228021729, upper bound: 59.13461677095803\n",
      "INFO:root:Number of voxels above upper bound to be clipped 8485 - percentage 0.491%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 19796 - percentage 1.146%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.34it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmptz3snlcu/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmptz3snlcu/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.36it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmptz3snlcu/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmptz3snlcu/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 78.65it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmptz3snlcu/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmptz3snlcu/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 85.44it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmptz3snlcu/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmptz3snlcu/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 80.60it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmptz3snlcu/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmptz3snlcu/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 83.62it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmptz3snlcu/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmptz3snlcu/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.16it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmptz3snlcu/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmptz3snlcu/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.91it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmptz3snlcu/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmptz3snlcu/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 89.88it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmptz3snlcu/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmptz3snlcu/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 81.40it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmptz3snlcu/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmptz3snlcu/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.45it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmptz3snlcu/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmptz3snlcu/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 86.41it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmptz3snlcu/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmptz3snlcu/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmptz3snlcu/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmptz3snlcu/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmptz3snlcu/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmptz3snlcu/pred_0_YX_90.h5   \n",
      "4    /tmp/tmptz3snlcu/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmptz3snlcu/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmptz3snlcu/pred_0_YX_180.h5   \n",
      "7   /tmp/tmptz3snlcu/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmptz3snlcu/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmptz3snlcu/pred_0_YX_270.h5   \n",
      "10  /tmp/tmptz3snlcu/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmptz3snlcu/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmptz3snlcu/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmptz3snlcu/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmptz3snlcu/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmptz3snlcu/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmptz3snlcu/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmptz3snlcu/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmptz3snlcu/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmptz3snlcu/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmptz3snlcu/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmptz3snlcu/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmptz3snlcu/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmptz3snlcu/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 408.85it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.53 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 0,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 0,56,200 , use origin iz00,iy00,ix00 = 0,56,136 , end iz1,iy1,ix1 = 120,176,256\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.405810763888889\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 21.16467280435912. Calculating stats.\n",
      "INFO:root:Lower bound: -51.09322170733585, upper bound: 57.904843235113624\n",
      "INFO:root:Number of voxels above upper bound to be clipped 9451 - percentage 0.547%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 17315 - percentage 1.002%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 100.91it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp34g4zt3p/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp34g4zt3p/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 101.01it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp34g4zt3p/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp34g4zt3p/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.57it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp34g4zt3p/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp34g4zt3p/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.69it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp34g4zt3p/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp34g4zt3p/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.63it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp34g4zt3p/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp34g4zt3p/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.54it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp34g4zt3p/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp34g4zt3p/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.99it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp34g4zt3p/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp34g4zt3p/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.27it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp34g4zt3p/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp34g4zt3p/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.92it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp34g4zt3p/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp34g4zt3p/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.41it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp34g4zt3p/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp34g4zt3p/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.06it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp34g4zt3p/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp34g4zt3p/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.84it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp34g4zt3p/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp34g4zt3p/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmp34g4zt3p/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmp34g4zt3p/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmp34g4zt3p/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmp34g4zt3p/pred_0_YX_90.h5   \n",
      "4    /tmp/tmp34g4zt3p/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmp34g4zt3p/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmp34g4zt3p/pred_0_YX_180.h5   \n",
      "7   /tmp/tmp34g4zt3p/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmp34g4zt3p/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmp34g4zt3p/pred_0_YX_270.h5   \n",
      "10  /tmp/tmp34g4zt3p/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmp34g4zt3p/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmp34g4zt3p/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmp34g4zt3p/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmp34g4zt3p/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmp34g4zt3p/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmp34g4zt3p/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmp34g4zt3p/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmp34g4zt3p/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmp34g4zt3p/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmp34g4zt3p/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmp34g4zt3p/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmp34g4zt3p/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmp34g4zt3p/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 481.21it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.54 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 0,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 0,112,0 , use origin iz00,iy00,ix00 = 0,112,0 , end iz1,iy1,ix1 = 120,232,120\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.35434375\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 23.466168530606698. Calculating stats.\n",
      "INFO:root:Lower bound: -57.071040216312255, upper bound: 63.77972771631225\n",
      "INFO:root:Number of voxels above upper bound to be clipped 10857 - percentage 0.628%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 15043 - percentage 0.871%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.69it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpl7naflts/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpl7naflts/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.89it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpl7naflts/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpl7naflts/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.92it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpl7naflts/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpl7naflts/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 88.41it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpl7naflts/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpl7naflts/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 87.72it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpl7naflts/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpl7naflts/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.28it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpl7naflts/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpl7naflts/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.81it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpl7naflts/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpl7naflts/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.70it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpl7naflts/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpl7naflts/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.08it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpl7naflts/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpl7naflts/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.64it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpl7naflts/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpl7naflts/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.39it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpl7naflts/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpl7naflts/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 86.47it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpl7naflts/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpl7naflts/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpl7naflts/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpl7naflts/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpl7naflts/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpl7naflts/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpl7naflts/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpl7naflts/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpl7naflts/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpl7naflts/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpl7naflts/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpl7naflts/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpl7naflts/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpl7naflts/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpl7naflts/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpl7naflts/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpl7naflts/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpl7naflts/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpl7naflts/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpl7naflts/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpl7naflts/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpl7naflts/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpl7naflts/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpl7naflts/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpl7naflts/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpl7naflts/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 496.32it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.45 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 0,32,0\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 0,112,100 , use origin iz00,iy00,ix00 = 0,112,100 , end iz1,iy1,ix1 = 120,232,220\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.3879212962962963\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 22.619970915045613. Calculating stats.\n",
      "INFO:root:Lower bound: -54.85850380994616, upper bound: 61.63434640253875\n",
      "INFO:root:Number of voxels above upper bound to be clipped 8407 - percentage 0.487%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 19670 - percentage 1.138%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.45it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3fpzf4mz/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3fpzf4mz/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.97it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3fpzf4mz/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3fpzf4mz/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.44it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3fpzf4mz/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3fpzf4mz/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.89it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3fpzf4mz/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3fpzf4mz/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.48it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3fpzf4mz/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3fpzf4mz/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.19it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3fpzf4mz/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3fpzf4mz/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.08it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3fpzf4mz/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3fpzf4mz/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.14it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3fpzf4mz/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3fpzf4mz/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.77it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3fpzf4mz/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3fpzf4mz/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.02it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3fpzf4mz/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3fpzf4mz/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.90it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3fpzf4mz/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3fpzf4mz/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.68it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3fpzf4mz/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3fpzf4mz/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmp3fpzf4mz/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmp3fpzf4mz/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmp3fpzf4mz/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmp3fpzf4mz/pred_0_YX_90.h5   \n",
      "4    /tmp/tmp3fpzf4mz/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmp3fpzf4mz/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmp3fpzf4mz/pred_0_YX_180.h5   \n",
      "7   /tmp/tmp3fpzf4mz/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmp3fpzf4mz/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmp3fpzf4mz/pred_0_YX_270.h5   \n",
      "10  /tmp/tmp3fpzf4mz/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmp3fpzf4mz/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmp3fpzf4mz/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmp3fpzf4mz/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmp3fpzf4mz/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmp3fpzf4mz/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmp3fpzf4mz/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmp3fpzf4mz/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmp3fpzf4mz/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmp3fpzf4mz/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmp3fpzf4mz/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmp3fpzf4mz/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmp3fpzf4mz/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmp3fpzf4mz/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 481.29it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.43 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 0,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 0,112,200 , use origin iz00,iy00,ix00 = 0,112,136 , end iz1,iy1,ix1 = 120,232,256\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.349834490740741\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 22.124657825255596. Calculating stats.\n",
      "INFO:root:Lower bound: -53.621159409292424, upper bound: 60.320828390773904\n",
      "INFO:root:Number of voxels above upper bound to be clipped 9264 - percentage 0.536%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 17282 - percentage 1.000%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.34it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpt62zufyy/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpt62zufyy/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.32it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpt62zufyy/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpt62zufyy/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.87it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpt62zufyy/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpt62zufyy/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.44it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpt62zufyy/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpt62zufyy/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.50it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpt62zufyy/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpt62zufyy/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 82.04it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpt62zufyy/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpt62zufyy/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 85.62it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpt62zufyy/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpt62zufyy/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.48it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpt62zufyy/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpt62zufyy/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 88.58it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpt62zufyy/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpt62zufyy/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 89.71it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpt62zufyy/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpt62zufyy/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.01it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpt62zufyy/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpt62zufyy/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.76it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpt62zufyy/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpt62zufyy/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpt62zufyy/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpt62zufyy/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpt62zufyy/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpt62zufyy/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpt62zufyy/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpt62zufyy/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpt62zufyy/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpt62zufyy/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpt62zufyy/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpt62zufyy/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpt62zufyy/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpt62zufyy/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpt62zufyy/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpt62zufyy/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpt62zufyy/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpt62zufyy/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpt62zufyy/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpt62zufyy/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpt62zufyy/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpt62zufyy/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpt62zufyy/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpt62zufyy/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpt62zufyy/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpt62zufyy/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 499.81it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.53 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 0,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 0,168,0 , use origin iz00,iy00,ix00 = 0,136,0 , end iz1,iy1,ix1 = 120,256,120\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.328505787037037\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 23.858404512714742. Calculating stats.\n",
      "INFO:root:Lower bound: -58.10688583320343, upper bound: 64.7638974072775\n",
      "INFO:root:Number of voxels above upper bound to be clipped 8945 - percentage 0.518%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 16426 - percentage 0.951%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 87.80it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpgileb94o/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpgileb94o/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.01it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpgileb94o/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpgileb94o/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 87.43it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpgileb94o/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpgileb94o/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.62it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpgileb94o/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpgileb94o/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 86.44it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpgileb94o/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpgileb94o/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.28it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpgileb94o/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpgileb94o/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.24it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpgileb94o/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpgileb94o/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 88.84it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpgileb94o/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpgileb94o/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 85.04it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpgileb94o/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpgileb94o/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.03it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpgileb94o/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpgileb94o/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 103.41it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpgileb94o/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpgileb94o/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 101.63it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpgileb94o/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpgileb94o/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpgileb94o/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpgileb94o/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpgileb94o/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpgileb94o/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpgileb94o/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpgileb94o/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpgileb94o/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpgileb94o/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpgileb94o/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpgileb94o/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpgileb94o/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpgileb94o/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpgileb94o/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpgileb94o/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpgileb94o/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpgileb94o/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpgileb94o/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpgileb94o/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpgileb94o/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpgileb94o/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpgileb94o/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpgileb94o/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpgileb94o/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpgileb94o/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 492.49it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.43 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 0,32,0\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 0,168,100 , use origin iz00,iy00,ix00 = 0,136,100 , end iz1,iy1,ix1 = 120,256,220\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.3850480324074073\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 23.03075580888477. Calculating stats.\n",
      "INFO:root:Lower bound: -55.91914817547088, upper bound: 62.68924424028569\n",
      "INFO:root:Number of voxels above upper bound to be clipped 9155 - percentage 0.530%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 17406 - percentage 1.007%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.06it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp2x4k_26g/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp2x4k_26g/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.98it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp2x4k_26g/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp2x4k_26g/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 82.94it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp2x4k_26g/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp2x4k_26g/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 100.47it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp2x4k_26g/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp2x4k_26g/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 89.51it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp2x4k_26g/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp2x4k_26g/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 78.35it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp2x4k_26g/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp2x4k_26g/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 72.63it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp2x4k_26g/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp2x4k_26g/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.46it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp2x4k_26g/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp2x4k_26g/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.78it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp2x4k_26g/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp2x4k_26g/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.09it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp2x4k_26g/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp2x4k_26g/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.92it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp2x4k_26g/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp2x4k_26g/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.43it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp2x4k_26g/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp2x4k_26g/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmp2x4k_26g/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmp2x4k_26g/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmp2x4k_26g/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmp2x4k_26g/pred_0_YX_90.h5   \n",
      "4    /tmp/tmp2x4k_26g/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmp2x4k_26g/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmp2x4k_26g/pred_0_YX_180.h5   \n",
      "7   /tmp/tmp2x4k_26g/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmp2x4k_26g/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmp2x4k_26g/pred_0_YX_270.h5   \n",
      "10  /tmp/tmp2x4k_26g/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmp2x4k_26g/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmp2x4k_26g/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmp2x4k_26g/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmp2x4k_26g/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmp2x4k_26g/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmp2x4k_26g/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmp2x4k_26g/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmp2x4k_26g/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmp2x4k_26g/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmp2x4k_26g/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmp2x4k_26g/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmp2x4k_26g/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmp2x4k_26g/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 432.67it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.44 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 0,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 0,168,200 , use origin iz00,iy00,ix00 = 0,136,136 , end iz1,iy1,ix1 = 120,256,256\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.3640850694444446\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 22.55581711949155. Calculating stats.\n",
      "INFO:root:Lower bound: -54.717144013246305, upper bound: 61.44531415213519\n",
      "INFO:root:Number of voxels above upper bound to be clipped 7751 - percentage 0.449%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 18910 - percentage 1.094%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 89.43it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpthmcn5tg/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpthmcn5tg/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.15it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpthmcn5tg/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpthmcn5tg/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.98it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpthmcn5tg/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpthmcn5tg/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.25it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpthmcn5tg/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpthmcn5tg/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.87it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpthmcn5tg/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpthmcn5tg/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.60it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpthmcn5tg/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpthmcn5tg/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 100.94it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpthmcn5tg/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpthmcn5tg/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 86.27it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpthmcn5tg/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpthmcn5tg/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 80.77it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpthmcn5tg/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpthmcn5tg/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.55it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpthmcn5tg/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpthmcn5tg/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.61it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpthmcn5tg/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpthmcn5tg/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.09it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpthmcn5tg/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpthmcn5tg/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpthmcn5tg/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpthmcn5tg/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpthmcn5tg/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpthmcn5tg/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpthmcn5tg/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpthmcn5tg/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpthmcn5tg/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpthmcn5tg/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpthmcn5tg/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpthmcn5tg/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpthmcn5tg/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpthmcn5tg/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpthmcn5tg/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpthmcn5tg/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpthmcn5tg/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpthmcn5tg/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpthmcn5tg/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpthmcn5tg/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpthmcn5tg/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpthmcn5tg/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpthmcn5tg/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpthmcn5tg/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpthmcn5tg/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpthmcn5tg/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 485.13it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.43 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 0,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 0,224,0 , use origin iz00,iy00,ix00 = 0,136,0 , end iz1,iy1,ix1 = 120,256,120\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.328505787037037\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 23.858404512714742. Calculating stats.\n",
      "INFO:root:Lower bound: -58.10688583320343, upper bound: 64.7638974072775\n",
      "INFO:root:Number of voxels above upper bound to be clipped 8945 - percentage 0.518%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 16426 - percentage 0.951%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.76it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpq58564_5/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpq58564_5/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.83it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpq58564_5/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpq58564_5/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.06it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpq58564_5/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpq58564_5/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.93it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpq58564_5/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpq58564_5/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.17it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpq58564_5/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpq58564_5/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 89.60it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpq58564_5/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpq58564_5/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.11it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpq58564_5/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpq58564_5/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.75it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpq58564_5/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpq58564_5/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 87.27it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpq58564_5/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpq58564_5/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.07it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpq58564_5/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpq58564_5/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.49it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpq58564_5/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpq58564_5/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 87.65it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpq58564_5/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpq58564_5/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpq58564_5/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpq58564_5/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpq58564_5/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpq58564_5/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpq58564_5/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpq58564_5/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpq58564_5/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpq58564_5/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpq58564_5/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpq58564_5/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpq58564_5/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpq58564_5/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpq58564_5/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpq58564_5/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpq58564_5/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpq58564_5/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpq58564_5/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpq58564_5/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpq58564_5/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpq58564_5/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpq58564_5/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpq58564_5/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpq58564_5/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpq58564_5/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 442.44it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.53 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 0,32,0\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 0,224,100 , use origin iz00,iy00,ix00 = 0,136,100 , end iz1,iy1,ix1 = 120,256,220\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.3850480324074073\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 23.03075580888477. Calculating stats.\n",
      "INFO:root:Lower bound: -55.91914817547088, upper bound: 62.68924424028569\n",
      "INFO:root:Number of voxels above upper bound to be clipped 9155 - percentage 0.530%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 17406 - percentage 1.007%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 87.08it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpomnds55e/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpomnds55e/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.55it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpomnds55e/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpomnds55e/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.20it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpomnds55e/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpomnds55e/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 102.96it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpomnds55e/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpomnds55e/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 101.27it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpomnds55e/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpomnds55e/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.69it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpomnds55e/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpomnds55e/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.82it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpomnds55e/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpomnds55e/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.96it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpomnds55e/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpomnds55e/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.09it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpomnds55e/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpomnds55e/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 88.48it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpomnds55e/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpomnds55e/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.96it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpomnds55e/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpomnds55e/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.03it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpomnds55e/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpomnds55e/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpomnds55e/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpomnds55e/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpomnds55e/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpomnds55e/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpomnds55e/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpomnds55e/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpomnds55e/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpomnds55e/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpomnds55e/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpomnds55e/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpomnds55e/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpomnds55e/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpomnds55e/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpomnds55e/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpomnds55e/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpomnds55e/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpomnds55e/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpomnds55e/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpomnds55e/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpomnds55e/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpomnds55e/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpomnds55e/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpomnds55e/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpomnds55e/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 428.96it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.43 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 0,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 0,224,200 , use origin iz00,iy00,ix00 = 0,136,136 , end iz1,iy1,ix1 = 120,256,256\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.3640850694444446\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 22.55581711949155. Calculating stats.\n",
      "INFO:root:Lower bound: -54.717144013246305, upper bound: 61.44531415213519\n",
      "INFO:root:Number of voxels above upper bound to be clipped 7751 - percentage 0.449%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 18910 - percentage 1.094%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 80.22it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmppb1v8pcg/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmppb1v8pcg/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 87.08it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmppb1v8pcg/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmppb1v8pcg/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 86.12it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmppb1v8pcg/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmppb1v8pcg/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 87.52it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmppb1v8pcg/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmppb1v8pcg/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.66it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmppb1v8pcg/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmppb1v8pcg/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.77it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmppb1v8pcg/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmppb1v8pcg/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.03it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmppb1v8pcg/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmppb1v8pcg/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 88.28it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmppb1v8pcg/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmppb1v8pcg/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.35it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmppb1v8pcg/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmppb1v8pcg/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.94it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmppb1v8pcg/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmppb1v8pcg/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.06it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmppb1v8pcg/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmppb1v8pcg/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.43it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmppb1v8pcg/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmppb1v8pcg/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmppb1v8pcg/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmppb1v8pcg/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmppb1v8pcg/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmppb1v8pcg/pred_0_YX_90.h5   \n",
      "4    /tmp/tmppb1v8pcg/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmppb1v8pcg/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmppb1v8pcg/pred_0_YX_180.h5   \n",
      "7   /tmp/tmppb1v8pcg/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmppb1v8pcg/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmppb1v8pcg/pred_0_YX_270.h5   \n",
      "10  /tmp/tmppb1v8pcg/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmppb1v8pcg/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmppb1v8pcg/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmppb1v8pcg/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmppb1v8pcg/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmppb1v8pcg/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmppb1v8pcg/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmppb1v8pcg/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmppb1v8pcg/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmppb1v8pcg/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmppb1v8pcg/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmppb1v8pcg/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmppb1v8pcg/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmppb1v8pcg/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 503.18it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.54 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 0,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 80,0,0 , use origin iz00,iy00,ix00 = 80,0,0 , end iz1,iy1,ix1 = 200,120,120\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.350169560185185\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 25.680395384209035. Calculating stats.\n",
      "INFO:root:Lower bound: -62.776848554153084, upper bound: 69.47718767452345\n",
      "INFO:root:Number of voxels above upper bound to be clipped 5576 - percentage 0.323%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 11863 - percentage 0.687%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.45it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpr6qhc5pg/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpr6qhc5pg/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.83it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpr6qhc5pg/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpr6qhc5pg/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.28it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpr6qhc5pg/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpr6qhc5pg/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.60it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpr6qhc5pg/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpr6qhc5pg/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.70it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpr6qhc5pg/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpr6qhc5pg/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.01it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpr6qhc5pg/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpr6qhc5pg/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.85it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpr6qhc5pg/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpr6qhc5pg/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 88.18it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpr6qhc5pg/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpr6qhc5pg/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 86.14it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpr6qhc5pg/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpr6qhc5pg/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.15it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpr6qhc5pg/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpr6qhc5pg/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.87it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpr6qhc5pg/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpr6qhc5pg/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.00it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpr6qhc5pg/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpr6qhc5pg/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpr6qhc5pg/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpr6qhc5pg/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpr6qhc5pg/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpr6qhc5pg/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpr6qhc5pg/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpr6qhc5pg/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpr6qhc5pg/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpr6qhc5pg/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpr6qhc5pg/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpr6qhc5pg/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpr6qhc5pg/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpr6qhc5pg/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpr6qhc5pg/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpr6qhc5pg/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpr6qhc5pg/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpr6qhc5pg/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpr6qhc5pg/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpr6qhc5pg/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpr6qhc5pg/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpr6qhc5pg/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpr6qhc5pg/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpr6qhc5pg/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpr6qhc5pg/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpr6qhc5pg/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 482.35it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.43 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,0,0\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 80,0,100 , use origin iz00,iy00,ix00 = 80,0,100 , end iz1,iy1,ix1 = 200,120,220\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.3867141203703706\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 25.112763942610027. Calculating stats.\n",
      "INFO:root:Lower bound: -61.27865303185045, upper bound: 68.0520812725912\n",
      "INFO:root:Number of voxels above upper bound to be clipped 4587 - percentage 0.265%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 14195 - percentage 0.821%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.30it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpu58fqlfv/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpu58fqlfv/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.97it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpu58fqlfv/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpu58fqlfv/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.13it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpu58fqlfv/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpu58fqlfv/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.11it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpu58fqlfv/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpu58fqlfv/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.11it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpu58fqlfv/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpu58fqlfv/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 86.85it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpu58fqlfv/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpu58fqlfv/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.47it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpu58fqlfv/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpu58fqlfv/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.97it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpu58fqlfv/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpu58fqlfv/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.95it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpu58fqlfv/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpu58fqlfv/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.14it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpu58fqlfv/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpu58fqlfv/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.33it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpu58fqlfv/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpu58fqlfv/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 87.91it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpu58fqlfv/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpu58fqlfv/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpu58fqlfv/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpu58fqlfv/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpu58fqlfv/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpu58fqlfv/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpu58fqlfv/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpu58fqlfv/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpu58fqlfv/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpu58fqlfv/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpu58fqlfv/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpu58fqlfv/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpu58fqlfv/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpu58fqlfv/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpu58fqlfv/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpu58fqlfv/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpu58fqlfv/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpu58fqlfv/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpu58fqlfv/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpu58fqlfv/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpu58fqlfv/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpu58fqlfv/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpu58fqlfv/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpu58fqlfv/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpu58fqlfv/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpu58fqlfv/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 479.99it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.54 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,0,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 80,0,200 , use origin iz00,iy00,ix00 = 80,0,136 , end iz1,iy1,ix1 = 200,120,256\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.3616927083333334\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 24.706331838187303. Calculating stats.\n",
      "INFO:root:Lower bound: -60.257111774998975, upper bound: 66.98049719166565\n",
      "INFO:root:Number of voxels above upper bound to be clipped 5701 - percentage 0.330%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 13047 - percentage 0.755%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.05it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpghzzv57d/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpghzzv57d/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.20it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpghzzv57d/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpghzzv57d/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 89.06it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpghzzv57d/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpghzzv57d/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.46it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpghzzv57d/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpghzzv57d/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.00it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpghzzv57d/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpghzzv57d/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.87it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpghzzv57d/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpghzzv57d/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.69it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpghzzv57d/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpghzzv57d/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 84.00it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpghzzv57d/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpghzzv57d/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 77.75it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpghzzv57d/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpghzzv57d/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.35it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpghzzv57d/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpghzzv57d/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.28it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpghzzv57d/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpghzzv57d/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.81it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpghzzv57d/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpghzzv57d/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpghzzv57d/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpghzzv57d/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpghzzv57d/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpghzzv57d/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpghzzv57d/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpghzzv57d/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpghzzv57d/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpghzzv57d/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpghzzv57d/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpghzzv57d/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpghzzv57d/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpghzzv57d/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpghzzv57d/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpghzzv57d/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpghzzv57d/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpghzzv57d/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpghzzv57d/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpghzzv57d/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpghzzv57d/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpghzzv57d/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpghzzv57d/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpghzzv57d/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpghzzv57d/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpghzzv57d/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 427.77it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.43 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,0,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 80,56,0 , use origin iz00,iy00,ix00 = 80,56,0 , end iz1,iy1,ix1 = 200,176,120\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.4649600694444445\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 25.73383205978163. Calculating stats.\n",
      "INFO:root:Lower bound: -62.79965748449325, upper bound: 69.72957762338214\n",
      "INFO:root:Number of voxels above upper bound to be clipped 5736 - percentage 0.332%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 12509 - percentage 0.724%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.88it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpja6d15cg/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpja6d15cg/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.77it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpja6d15cg/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpja6d15cg/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 86.36it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpja6d15cg/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpja6d15cg/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 84.22it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpja6d15cg/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpja6d15cg/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 89.35it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpja6d15cg/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpja6d15cg/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 88.46it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpja6d15cg/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpja6d15cg/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.93it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpja6d15cg/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpja6d15cg/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.34it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpja6d15cg/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpja6d15cg/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 87.03it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpja6d15cg/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpja6d15cg/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.36it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpja6d15cg/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpja6d15cg/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.22it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpja6d15cg/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpja6d15cg/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.42it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpja6d15cg/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpja6d15cg/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpja6d15cg/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpja6d15cg/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpja6d15cg/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpja6d15cg/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpja6d15cg/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpja6d15cg/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpja6d15cg/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpja6d15cg/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpja6d15cg/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpja6d15cg/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpja6d15cg/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpja6d15cg/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpja6d15cg/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpja6d15cg/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpja6d15cg/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpja6d15cg/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpja6d15cg/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpja6d15cg/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpja6d15cg/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpja6d15cg/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpja6d15cg/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpja6d15cg/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpja6d15cg/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpja6d15cg/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 492.54it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.53 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,0\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 80,56,100 , use origin iz00,iy00,ix00 = 80,56,100 , end iz1,iy1,ix1 = 200,176,220\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.4704456018518517\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 25.060660603241963. Calculating stats.\n",
      "INFO:root:Lower bound: -61.060755451496206, upper bound: 68.0016466551999\n",
      "INFO:root:Number of voxels above upper bound to be clipped 4566 - percentage 0.264%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 14397 - percentage 0.833%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 88.53it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpk1qlh8hw/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpk1qlh8hw/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.93it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpk1qlh8hw/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpk1qlh8hw/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 86.47it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpk1qlh8hw/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpk1qlh8hw/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.12it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpk1qlh8hw/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpk1qlh8hw/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.76it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpk1qlh8hw/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpk1qlh8hw/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 88.42it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpk1qlh8hw/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpk1qlh8hw/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.53it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpk1qlh8hw/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpk1qlh8hw/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.51it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpk1qlh8hw/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpk1qlh8hw/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.32it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpk1qlh8hw/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpk1qlh8hw/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.85it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpk1qlh8hw/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpk1qlh8hw/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 102.60it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpk1qlh8hw/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpk1qlh8hw/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.58it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpk1qlh8hw/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpk1qlh8hw/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpk1qlh8hw/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpk1qlh8hw/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpk1qlh8hw/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpk1qlh8hw/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpk1qlh8hw/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpk1qlh8hw/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpk1qlh8hw/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpk1qlh8hw/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpk1qlh8hw/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpk1qlh8hw/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpk1qlh8hw/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpk1qlh8hw/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpk1qlh8hw/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpk1qlh8hw/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpk1qlh8hw/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpk1qlh8hw/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpk1qlh8hw/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpk1qlh8hw/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpk1qlh8hw/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpk1qlh8hw/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpk1qlh8hw/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpk1qlh8hw/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpk1qlh8hw/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpk1qlh8hw/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 469.16it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.43 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 80,56,200 , use origin iz00,iy00,ix00 = 80,56,136 , end iz1,iy1,ix1 = 200,176,256\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.4986903935185185\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 24.724304645087173. Calculating stats.\n",
      "INFO:root:Lower bound: -60.16639406758096, upper bound: 67.163774854618\n",
      "INFO:root:Number of voxels above upper bound to be clipped 5513 - percentage 0.319%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 13201 - percentage 0.764%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 84.33it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3rojuygj/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3rojuygj/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 83.07it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3rojuygj/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3rojuygj/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 72.39it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3rojuygj/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3rojuygj/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 78.14it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3rojuygj/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3rojuygj/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 80.82it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3rojuygj/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3rojuygj/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.17it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3rojuygj/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3rojuygj/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.31it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3rojuygj/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3rojuygj/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.18it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3rojuygj/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3rojuygj/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.48it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3rojuygj/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3rojuygj/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 88.25it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3rojuygj/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3rojuygj/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.73it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3rojuygj/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3rojuygj/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 87.16it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3rojuygj/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3rojuygj/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmp3rojuygj/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmp3rojuygj/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmp3rojuygj/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmp3rojuygj/pred_0_YX_90.h5   \n",
      "4    /tmp/tmp3rojuygj/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmp3rojuygj/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmp3rojuygj/pred_0_YX_180.h5   \n",
      "7   /tmp/tmp3rojuygj/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmp3rojuygj/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmp3rojuygj/pred_0_YX_270.h5   \n",
      "10  /tmp/tmp3rojuygj/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmp3rojuygj/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmp3rojuygj/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmp3rojuygj/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmp3rojuygj/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmp3rojuygj/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmp3rojuygj/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmp3rojuygj/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmp3rojuygj/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmp3rojuygj/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmp3rojuygj/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmp3rojuygj/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmp3rojuygj/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmp3rojuygj/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 488.54it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.43 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 80,112,0 , use origin iz00,iy00,ix00 = 80,112,0 , end iz1,iy1,ix1 = 200,232,120\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.5258854166666667\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 25.345077117891563. Calculating stats.\n",
      "INFO:root:Lower bound: -61.73768816190412, upper bound: 68.78945899523745\n",
      "INFO:root:Number of voxels above upper bound to be clipped 5785 - percentage 0.335%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 16077 - percentage 0.930%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.63it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp0nf0ykcj/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp0nf0ykcj/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.85it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp0nf0ykcj/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp0nf0ykcj/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.17it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp0nf0ykcj/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp0nf0ykcj/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.58it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp0nf0ykcj/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp0nf0ykcj/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.36it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp0nf0ykcj/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp0nf0ykcj/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.10it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp0nf0ykcj/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp0nf0ykcj/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.60it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp0nf0ykcj/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp0nf0ykcj/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.52it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp0nf0ykcj/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp0nf0ykcj/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.01it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp0nf0ykcj/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp0nf0ykcj/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.12it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp0nf0ykcj/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp0nf0ykcj/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.09it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp0nf0ykcj/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp0nf0ykcj/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 88.12it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp0nf0ykcj/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp0nf0ykcj/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmp0nf0ykcj/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmp0nf0ykcj/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmp0nf0ykcj/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmp0nf0ykcj/pred_0_YX_90.h5   \n",
      "4    /tmp/tmp0nf0ykcj/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmp0nf0ykcj/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmp0nf0ykcj/pred_0_YX_180.h5   \n",
      "7   /tmp/tmp0nf0ykcj/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmp0nf0ykcj/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmp0nf0ykcj/pred_0_YX_270.h5   \n",
      "10  /tmp/tmp0nf0ykcj/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmp0nf0ykcj/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmp0nf0ykcj/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmp0nf0ykcj/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmp0nf0ykcj/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmp0nf0ykcj/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmp0nf0ykcj/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmp0nf0ykcj/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmp0nf0ykcj/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmp0nf0ykcj/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmp0nf0ykcj/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmp0nf0ykcj/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmp0nf0ykcj/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmp0nf0ykcj/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 436.31it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.54 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,0\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 80,112,100 , use origin iz00,iy00,ix00 = 80,112,100 , end iz1,iy1,ix1 = 200,232,220\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.400564814814815\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 24.85865416143886. Calculating stats.\n",
      "INFO:root:Lower bound: -60.61046965089025, upper bound: 67.41159928051988\n",
      "INFO:root:Number of voxels above upper bound to be clipped 6116 - percentage 0.354%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 14018 - percentage 0.811%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.58it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp_ouxb4_0/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp_ouxb4_0/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.13it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp_ouxb4_0/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp_ouxb4_0/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.27it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp_ouxb4_0/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp_ouxb4_0/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.37it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp_ouxb4_0/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp_ouxb4_0/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 85.60it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp_ouxb4_0/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp_ouxb4_0/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.70it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp_ouxb4_0/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp_ouxb4_0/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.25it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp_ouxb4_0/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp_ouxb4_0/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.12it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp_ouxb4_0/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp_ouxb4_0/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 87.39it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp_ouxb4_0/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp_ouxb4_0/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.38it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp_ouxb4_0/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp_ouxb4_0/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 88.04it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp_ouxb4_0/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp_ouxb4_0/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 85.80it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp_ouxb4_0/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp_ouxb4_0/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmp_ouxb4_0/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmp_ouxb4_0/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmp_ouxb4_0/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmp_ouxb4_0/pred_0_YX_90.h5   \n",
      "4    /tmp/tmp_ouxb4_0/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmp_ouxb4_0/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmp_ouxb4_0/pred_0_YX_180.h5   \n",
      "7   /tmp/tmp_ouxb4_0/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmp_ouxb4_0/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmp_ouxb4_0/pred_0_YX_270.h5   \n",
      "10  /tmp/tmp_ouxb4_0/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmp_ouxb4_0/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmp_ouxb4_0/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmp_ouxb4_0/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmp_ouxb4_0/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmp_ouxb4_0/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmp_ouxb4_0/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmp_ouxb4_0/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmp_ouxb4_0/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmp_ouxb4_0/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmp_ouxb4_0/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmp_ouxb4_0/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmp_ouxb4_0/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmp_ouxb4_0/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 454.68it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.54 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 80,112,200 , use origin iz00,iy00,ix00 = 80,112,136 , end iz1,iy1,ix1 = 200,232,256\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.4064872685185184\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 24.67995467533233. Calculating stats.\n",
      "INFO:root:Lower bound: -60.14439602046223, upper bound: 66.95737055749927\n",
      "INFO:root:Number of voxels above upper bound to be clipped 5722 - percentage 0.331%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 12754 - percentage 0.738%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.35it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmplnr1mrg3/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmplnr1mrg3/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.06it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmplnr1mrg3/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmplnr1mrg3/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.63it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmplnr1mrg3/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmplnr1mrg3/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.41it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmplnr1mrg3/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmplnr1mrg3/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.31it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmplnr1mrg3/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmplnr1mrg3/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.79it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmplnr1mrg3/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmplnr1mrg3/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.75it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmplnr1mrg3/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmplnr1mrg3/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.65it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmplnr1mrg3/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmplnr1mrg3/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 89.60it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmplnr1mrg3/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmplnr1mrg3/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.42it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmplnr1mrg3/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmplnr1mrg3/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.53it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmplnr1mrg3/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmplnr1mrg3/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 88.02it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmplnr1mrg3/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmplnr1mrg3/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmplnr1mrg3/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmplnr1mrg3/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmplnr1mrg3/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmplnr1mrg3/pred_0_YX_90.h5   \n",
      "4    /tmp/tmplnr1mrg3/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmplnr1mrg3/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmplnr1mrg3/pred_0_YX_180.h5   \n",
      "7   /tmp/tmplnr1mrg3/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmplnr1mrg3/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmplnr1mrg3/pred_0_YX_270.h5   \n",
      "10  /tmp/tmplnr1mrg3/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmplnr1mrg3/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmplnr1mrg3/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmplnr1mrg3/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmplnr1mrg3/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmplnr1mrg3/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmplnr1mrg3/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmplnr1mrg3/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmplnr1mrg3/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmplnr1mrg3/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmplnr1mrg3/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmplnr1mrg3/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmplnr1mrg3/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmplnr1mrg3/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 475.47it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.43 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 80,168,0 , use origin iz00,iy00,ix00 = 80,136,0 , end iz1,iy1,ix1 = 200,256,120\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.5328292824074072\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 25.05349828676394. Calculating stats.\n",
      "INFO:root:Lower bound: -60.97992880600974, upper bound: 68.04558737082455\n",
      "INFO:root:Number of voxels above upper bound to be clipped 5616 - percentage 0.325%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 15390 - percentage 0.891%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.17it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpb12an12y/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpb12an12y/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.99it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpb12an12y/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpb12an12y/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 75.94it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpb12an12y/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpb12an12y/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 88.85it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpb12an12y/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpb12an12y/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.63it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpb12an12y/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpb12an12y/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.31it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpb12an12y/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpb12an12y/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.16it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpb12an12y/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpb12an12y/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.18it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpb12an12y/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpb12an12y/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.50it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpb12an12y/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpb12an12y/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.81it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpb12an12y/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpb12an12y/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.04it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpb12an12y/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpb12an12y/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.43it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpb12an12y/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpb12an12y/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpb12an12y/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpb12an12y/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpb12an12y/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpb12an12y/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpb12an12y/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpb12an12y/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpb12an12y/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpb12an12y/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpb12an12y/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpb12an12y/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpb12an12y/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpb12an12y/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpb12an12y/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpb12an12y/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpb12an12y/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpb12an12y/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpb12an12y/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpb12an12y/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpb12an12y/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpb12an12y/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpb12an12y/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpb12an12y/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpb12an12y/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpb12an12y/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 506.21it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.43 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,0\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 80,168,100 , use origin iz00,iy00,ix00 = 80,136,100 , end iz1,iy1,ix1 = 200,256,220\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.3672065972222223\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 24.84307480792541. Calculating stats.\n",
      "INFO:root:Lower bound: -60.60371103318572, upper bound: 67.33812422763016\n",
      "INFO:root:Number of voxels above upper bound to be clipped 6325 - percentage 0.366%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 14152 - percentage 0.819%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 100.29it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpmgvmq3h_/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpmgvmq3h_/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.50it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpmgvmq3h_/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpmgvmq3h_/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.28it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpmgvmq3h_/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpmgvmq3h_/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.63it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpmgvmq3h_/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpmgvmq3h_/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.27it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpmgvmq3h_/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpmgvmq3h_/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 83.75it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpmgvmq3h_/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpmgvmq3h_/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 83.73it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpmgvmq3h_/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpmgvmq3h_/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 87.31it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpmgvmq3h_/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpmgvmq3h_/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 89.63it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpmgvmq3h_/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpmgvmq3h_/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 88.75it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpmgvmq3h_/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpmgvmq3h_/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 85.97it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpmgvmq3h_/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpmgvmq3h_/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 79.42it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpmgvmq3h_/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpmgvmq3h_/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpmgvmq3h_/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpmgvmq3h_/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpmgvmq3h_/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpmgvmq3h_/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpmgvmq3h_/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpmgvmq3h_/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpmgvmq3h_/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpmgvmq3h_/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpmgvmq3h_/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpmgvmq3h_/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpmgvmq3h_/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpmgvmq3h_/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpmgvmq3h_/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpmgvmq3h_/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpmgvmq3h_/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpmgvmq3h_/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpmgvmq3h_/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpmgvmq3h_/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpmgvmq3h_/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpmgvmq3h_/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpmgvmq3h_/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpmgvmq3h_/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpmgvmq3h_/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpmgvmq3h_/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 502.81it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.64 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 80,168,200 , use origin iz00,iy00,ix00 = 80,136,136 , end iz1,iy1,ix1 = 200,256,256\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.368972800925926\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 24.668282880101977. Calculating stats.\n",
      "INFO:root:Lower bound: -60.15185561533667, upper bound: 66.88980121718852\n",
      "INFO:root:Number of voxels above upper bound to be clipped 5804 - percentage 0.336%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 13010 - percentage 0.753%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 75.78it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpk5zshg7i/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpk5zshg7i/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 74.41it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpk5zshg7i/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpk5zshg7i/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 71.30it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpk5zshg7i/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpk5zshg7i/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 61.01it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpk5zshg7i/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpk5zshg7i/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 64.05it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpk5zshg7i/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpk5zshg7i/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 68.40it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpk5zshg7i/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpk5zshg7i/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.42it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpk5zshg7i/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpk5zshg7i/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 76.39it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpk5zshg7i/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpk5zshg7i/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 82.37it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpk5zshg7i/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpk5zshg7i/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 86.98it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpk5zshg7i/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpk5zshg7i/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.88it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpk5zshg7i/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpk5zshg7i/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.34it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpk5zshg7i/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpk5zshg7i/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpk5zshg7i/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpk5zshg7i/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpk5zshg7i/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpk5zshg7i/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpk5zshg7i/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpk5zshg7i/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpk5zshg7i/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpk5zshg7i/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpk5zshg7i/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpk5zshg7i/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpk5zshg7i/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpk5zshg7i/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpk5zshg7i/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpk5zshg7i/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpk5zshg7i/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpk5zshg7i/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpk5zshg7i/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpk5zshg7i/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpk5zshg7i/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpk5zshg7i/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpk5zshg7i/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpk5zshg7i/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpk5zshg7i/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpk5zshg7i/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 448.95it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.74 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 80,224,0 , use origin iz00,iy00,ix00 = 80,136,0 , end iz1,iy1,ix1 = 200,256,120\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.5328292824074072\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 25.05349828676394. Calculating stats.\n",
      "INFO:root:Lower bound: -60.97992880600974, upper bound: 68.04558737082455\n",
      "INFO:root:Number of voxels above upper bound to be clipped 5616 - percentage 0.325%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 15390 - percentage 0.891%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 77.66it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp8rzpgal5/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp8rzpgal5/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 81.73it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp8rzpgal5/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp8rzpgal5/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 78.14it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp8rzpgal5/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp8rzpgal5/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 79.82it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp8rzpgal5/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp8rzpgal5/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 78.67it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp8rzpgal5/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp8rzpgal5/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 71.92it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp8rzpgal5/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp8rzpgal5/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 76.14it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp8rzpgal5/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp8rzpgal5/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 77.76it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp8rzpgal5/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp8rzpgal5/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 76.56it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp8rzpgal5/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp8rzpgal5/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 51.66it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp8rzpgal5/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp8rzpgal5/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:01<00:00, 22.52it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp8rzpgal5/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp8rzpgal5/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:01<00:00, 20.73it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp8rzpgal5/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp8rzpgal5/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmp8rzpgal5/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmp8rzpgal5/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmp8rzpgal5/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmp8rzpgal5/pred_0_YX_90.h5   \n",
      "4    /tmp/tmp8rzpgal5/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmp8rzpgal5/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmp8rzpgal5/pred_0_YX_180.h5   \n",
      "7   /tmp/tmp8rzpgal5/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmp8rzpgal5/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmp8rzpgal5/pred_0_YX_270.h5   \n",
      "10  /tmp/tmp8rzpgal5/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmp8rzpgal5/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmp8rzpgal5/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmp8rzpgal5/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmp8rzpgal5/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmp8rzpgal5/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmp8rzpgal5/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmp8rzpgal5/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmp8rzpgal5/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmp8rzpgal5/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmp8rzpgal5/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmp8rzpgal5/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmp8rzpgal5/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmp8rzpgal5/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 176.03it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 4.61 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,0\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 80,224,100 , use origin iz00,iy00,ix00 = 80,136,100 , end iz1,iy1,ix1 = 200,256,220\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.3672065972222223\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 24.84307480792541. Calculating stats.\n",
      "INFO:root:Lower bound: -60.60371103318572, upper bound: 67.33812422763016\n",
      "INFO:root:Number of voxels above upper bound to be clipped 6325 - percentage 0.366%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 14152 - percentage 0.819%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:01<00:00, 28.81it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpwj9wkpsk/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpwj9wkpsk/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 36.15it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpwj9wkpsk/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpwj9wkpsk/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 37.12it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpwj9wkpsk/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpwj9wkpsk/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:01<00:00, 28.04it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpwj9wkpsk/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpwj9wkpsk/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 56.03it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpwj9wkpsk/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpwj9wkpsk/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 75.22it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpwj9wkpsk/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpwj9wkpsk/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.20it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpwj9wkpsk/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpwj9wkpsk/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 88.51it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpwj9wkpsk/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpwj9wkpsk/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.03it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpwj9wkpsk/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpwj9wkpsk/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 104.33it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpwj9wkpsk/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpwj9wkpsk/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.02it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpwj9wkpsk/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpwj9wkpsk/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.94it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpwj9wkpsk/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpwj9wkpsk/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpwj9wkpsk/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpwj9wkpsk/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpwj9wkpsk/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpwj9wkpsk/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpwj9wkpsk/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpwj9wkpsk/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpwj9wkpsk/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpwj9wkpsk/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpwj9wkpsk/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpwj9wkpsk/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpwj9wkpsk/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpwj9wkpsk/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpwj9wkpsk/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpwj9wkpsk/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpwj9wkpsk/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpwj9wkpsk/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpwj9wkpsk/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpwj9wkpsk/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpwj9wkpsk/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpwj9wkpsk/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpwj9wkpsk/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpwj9wkpsk/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpwj9wkpsk/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpwj9wkpsk/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 515.62it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.33 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 80,224,200 , use origin iz00,iy00,ix00 = 80,136,136 , end iz1,iy1,ix1 = 200,256,256\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.368972800925926\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 24.668282880101977. Calculating stats.\n",
      "INFO:root:Lower bound: -60.15185561533667, upper bound: 66.88980121718852\n",
      "INFO:root:Number of voxels above upper bound to be clipped 5804 - percentage 0.336%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 13010 - percentage 0.753%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.46it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpemp5kk0t/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpemp5kk0t/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.27it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpemp5kk0t/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpemp5kk0t/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.77it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpemp5kk0t/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpemp5kk0t/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 100.99it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpemp5kk0t/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpemp5kk0t/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.18it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpemp5kk0t/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpemp5kk0t/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.40it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpemp5kk0t/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpemp5kk0t/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.47it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpemp5kk0t/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpemp5kk0t/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.17it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpemp5kk0t/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpemp5kk0t/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 88.80it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpemp5kk0t/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpemp5kk0t/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.19it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpemp5kk0t/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpemp5kk0t/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.30it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpemp5kk0t/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpemp5kk0t/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.19it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpemp5kk0t/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpemp5kk0t/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpemp5kk0t/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpemp5kk0t/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpemp5kk0t/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpemp5kk0t/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpemp5kk0t/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpemp5kk0t/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpemp5kk0t/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpemp5kk0t/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpemp5kk0t/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpemp5kk0t/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpemp5kk0t/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpemp5kk0t/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpemp5kk0t/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpemp5kk0t/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpemp5kk0t/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpemp5kk0t/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpemp5kk0t/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpemp5kk0t/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpemp5kk0t/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpemp5kk0t/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpemp5kk0t/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpemp5kk0t/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpemp5kk0t/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpemp5kk0t/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 449.13it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.43 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 160,0,0 , use origin iz00,iy00,ix00 = 136,0,0 , end iz1,iy1,ix1 = 256,120,120\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.333677662037037\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 22.539315883384873. Calculating stats.\n",
      "INFO:root:Lower bound: -54.70506073767901, upper bound: 61.37241606175309\n",
      "INFO:root:Number of voxels above upper bound to be clipped 7790 - percentage 0.451%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 18477 - percentage 1.069%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.94it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeod1nln7/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeod1nln7/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.27it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeod1nln7/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeod1nln7/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.95it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeod1nln7/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeod1nln7/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.82it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeod1nln7/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeod1nln7/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.47it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeod1nln7/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeod1nln7/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 88.46it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeod1nln7/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeod1nln7/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.45it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeod1nln7/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeod1nln7/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 86.87it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeod1nln7/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeod1nln7/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.29it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeod1nln7/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeod1nln7/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 86.05it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeod1nln7/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeod1nln7/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.51it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeod1nln7/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeod1nln7/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.48it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeod1nln7/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeod1nln7/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpeod1nln7/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpeod1nln7/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpeod1nln7/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpeod1nln7/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpeod1nln7/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpeod1nln7/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpeod1nln7/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpeod1nln7/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpeod1nln7/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpeod1nln7/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpeod1nln7/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpeod1nln7/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpeod1nln7/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpeod1nln7/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpeod1nln7/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpeod1nln7/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpeod1nln7/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpeod1nln7/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpeod1nln7/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpeod1nln7/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpeod1nln7/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpeod1nln7/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpeod1nln7/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpeod1nln7/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 390.26it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.33 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,0,0\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 160,0,100 , use origin iz00,iy00,ix00 = 136,0,100 , end iz1,iy1,ix1 = 256,120,220\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.364895833333333\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 22.21822904115583. Calculating stats.\n",
      "INFO:root:Lower bound: -53.84704394764293, upper bound: 60.5768356143096\n",
      "INFO:root:Number of voxels above upper bound to be clipped 9003 - percentage 0.521%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 17360 - percentage 1.005%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 89.76it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpxxcgdibx/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpxxcgdibx/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.30it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpxxcgdibx/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpxxcgdibx/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 89.94it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpxxcgdibx/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpxxcgdibx/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.35it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpxxcgdibx/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpxxcgdibx/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 89.50it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpxxcgdibx/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpxxcgdibx/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 81.95it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpxxcgdibx/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpxxcgdibx/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.48it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpxxcgdibx/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpxxcgdibx/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.10it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpxxcgdibx/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpxxcgdibx/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 89.86it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpxxcgdibx/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpxxcgdibx/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.57it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpxxcgdibx/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpxxcgdibx/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 87.56it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpxxcgdibx/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpxxcgdibx/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 86.00it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpxxcgdibx/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpxxcgdibx/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpxxcgdibx/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpxxcgdibx/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpxxcgdibx/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpxxcgdibx/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpxxcgdibx/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpxxcgdibx/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpxxcgdibx/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpxxcgdibx/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpxxcgdibx/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpxxcgdibx/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpxxcgdibx/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpxxcgdibx/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpxxcgdibx/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpxxcgdibx/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpxxcgdibx/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpxxcgdibx/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpxxcgdibx/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpxxcgdibx/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpxxcgdibx/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpxxcgdibx/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpxxcgdibx/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpxxcgdibx/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpxxcgdibx/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpxxcgdibx/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 450.19it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.43 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,0,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 160,0,200 , use origin iz00,iy00,ix00 = 136,0,136 , end iz1,iy1,ix1 = 256,120,256\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.407494212962963\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 22.119019579766775. Calculating stats.\n",
      "INFO:root:Lower bound: -53.54898120493648, upper bound: 60.363969630862414\n",
      "INFO:root:Number of voxels above upper bound to be clipped 8686 - percentage 0.503%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 16952 - percentage 0.981%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 100.53it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpzj70k04a/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpzj70k04a/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.49it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpzj70k04a/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpzj70k04a/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.36it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpzj70k04a/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpzj70k04a/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.23it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpzj70k04a/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpzj70k04a/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.55it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpzj70k04a/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpzj70k04a/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.82it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpzj70k04a/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpzj70k04a/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.14it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpzj70k04a/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpzj70k04a/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.04it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpzj70k04a/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpzj70k04a/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 87.50it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpzj70k04a/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpzj70k04a/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.20it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpzj70k04a/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpzj70k04a/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.56it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpzj70k04a/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpzj70k04a/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 86.95it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpzj70k04a/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpzj70k04a/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpzj70k04a/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpzj70k04a/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpzj70k04a/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpzj70k04a/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpzj70k04a/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpzj70k04a/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpzj70k04a/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpzj70k04a/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpzj70k04a/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpzj70k04a/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpzj70k04a/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpzj70k04a/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpzj70k04a/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpzj70k04a/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpzj70k04a/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpzj70k04a/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpzj70k04a/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpzj70k04a/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpzj70k04a/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpzj70k04a/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpzj70k04a/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpzj70k04a/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpzj70k04a/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpzj70k04a/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 465.42it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.43 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,0,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 160,56,0 , use origin iz00,iy00,ix00 = 136,56,0 , end iz1,iy1,ix1 = 256,176,120\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.4173391203703702\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 22.25838237968924. Calculating stats.\n",
      "INFO:root:Lower bound: -53.897995507329426, upper bound: 60.73267374807017\n",
      "INFO:root:Number of voxels above upper bound to be clipped 9911 - percentage 0.574%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 18734 - percentage 1.084%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.51it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpdqwv32ll/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpdqwv32ll/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.52it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpdqwv32ll/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpdqwv32ll/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.02it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpdqwv32ll/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpdqwv32ll/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 100.97it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpdqwv32ll/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpdqwv32ll/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 101.11it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpdqwv32ll/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpdqwv32ll/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.00it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpdqwv32ll/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpdqwv32ll/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.51it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpdqwv32ll/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpdqwv32ll/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 89.61it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpdqwv32ll/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpdqwv32ll/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.49it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpdqwv32ll/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpdqwv32ll/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.08it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpdqwv32ll/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpdqwv32ll/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.26it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpdqwv32ll/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpdqwv32ll/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 84.17it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpdqwv32ll/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpdqwv32ll/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpdqwv32ll/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpdqwv32ll/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpdqwv32ll/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpdqwv32ll/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpdqwv32ll/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpdqwv32ll/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpdqwv32ll/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpdqwv32ll/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpdqwv32ll/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpdqwv32ll/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpdqwv32ll/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpdqwv32ll/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpdqwv32ll/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpdqwv32ll/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpdqwv32ll/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpdqwv32ll/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpdqwv32ll/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpdqwv32ll/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpdqwv32ll/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpdqwv32ll/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpdqwv32ll/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpdqwv32ll/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpdqwv32ll/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpdqwv32ll/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 467.37it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.43 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,0\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 160,56,100 , use origin iz00,iy00,ix00 = 136,56,100 , end iz1,iy1,ix1 = 256,176,220\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.4573188657407408\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 21.469374507579488. Calculating stats.\n",
      "INFO:root:Lower bound: -51.82632049127645, upper bound: 58.740958222757925\n",
      "INFO:root:Number of voxels above upper bound to be clipped 10190 - percentage 0.590%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 18540 - percentage 1.073%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.44it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpqnq7faym/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpqnq7faym/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.52it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpqnq7faym/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpqnq7faym/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.62it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpqnq7faym/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpqnq7faym/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 88.62it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpqnq7faym/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpqnq7faym/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.51it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpqnq7faym/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpqnq7faym/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.16it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpqnq7faym/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpqnq7faym/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.47it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpqnq7faym/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpqnq7faym/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 100.66it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpqnq7faym/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpqnq7faym/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.38it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpqnq7faym/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpqnq7faym/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.24it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpqnq7faym/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpqnq7faym/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.95it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpqnq7faym/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpqnq7faym/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 100.22it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpqnq7faym/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpqnq7faym/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpqnq7faym/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpqnq7faym/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpqnq7faym/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpqnq7faym/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpqnq7faym/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpqnq7faym/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpqnq7faym/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpqnq7faym/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpqnq7faym/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpqnq7faym/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpqnq7faym/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpqnq7faym/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpqnq7faym/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpqnq7faym/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpqnq7faym/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpqnq7faym/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpqnq7faym/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpqnq7faym/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpqnq7faym/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpqnq7faym/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpqnq7faym/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpqnq7faym/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpqnq7faym/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpqnq7faym/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 463.23it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.33 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 160,56,200 , use origin iz00,iy00,ix00 = 136,56,136 , end iz1,iy1,ix1 = 256,176,256\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.528470486111111\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 21.625563621127206. Calculating stats.\n",
      "INFO:root:Lower bound: -52.15735583829145, upper bound: 59.21429681051367\n",
      "INFO:root:Number of voxels above upper bound to be clipped 7921 - percentage 0.458%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 18653 - percentage 1.079%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.79it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpqcd98s6d/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpqcd98s6d/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.81it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpqcd98s6d/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpqcd98s6d/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.63it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpqcd98s6d/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpqcd98s6d/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.02it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpqcd98s6d/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpqcd98s6d/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.29it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpqcd98s6d/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpqcd98s6d/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.44it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpqcd98s6d/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpqcd98s6d/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.58it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpqcd98s6d/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpqcd98s6d/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.73it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpqcd98s6d/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpqcd98s6d/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.06it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpqcd98s6d/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpqcd98s6d/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.63it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpqcd98s6d/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpqcd98s6d/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.14it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpqcd98s6d/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpqcd98s6d/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.64it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpqcd98s6d/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpqcd98s6d/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpqcd98s6d/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpqcd98s6d/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpqcd98s6d/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpqcd98s6d/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpqcd98s6d/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpqcd98s6d/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpqcd98s6d/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpqcd98s6d/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpqcd98s6d/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpqcd98s6d/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpqcd98s6d/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpqcd98s6d/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpqcd98s6d/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpqcd98s6d/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpqcd98s6d/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpqcd98s6d/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpqcd98s6d/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpqcd98s6d/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpqcd98s6d/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpqcd98s6d/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpqcd98s6d/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpqcd98s6d/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpqcd98s6d/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpqcd98s6d/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 518.66it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.43 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 160,112,0 , use origin iz00,iy00,ix00 = 136,112,0 , end iz1,iy1,ix1 = 256,232,120\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.5085677083333335\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 21.823908631062555. Calculating stats.\n",
      "INFO:root:Lower bound: -52.68799701665275, upper bound: 59.70513243331941\n",
      "INFO:root:Number of voxels above upper bound to be clipped 9349 - percentage 0.541%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 21101 - percentage 1.221%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 104.78it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpv8jogkme/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpv8jogkme/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 102.08it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpv8jogkme/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpv8jogkme/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.07it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpv8jogkme/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpv8jogkme/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 102.80it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpv8jogkme/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpv8jogkme/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 101.00it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpv8jogkme/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpv8jogkme/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.30it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpv8jogkme/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpv8jogkme/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.09it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpv8jogkme/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpv8jogkme/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.62it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpv8jogkme/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpv8jogkme/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.62it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpv8jogkme/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpv8jogkme/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.02it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpv8jogkme/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpv8jogkme/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.16it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpv8jogkme/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpv8jogkme/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.19it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpv8jogkme/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpv8jogkme/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpv8jogkme/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpv8jogkme/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpv8jogkme/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpv8jogkme/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpv8jogkme/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpv8jogkme/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpv8jogkme/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpv8jogkme/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpv8jogkme/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpv8jogkme/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpv8jogkme/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpv8jogkme/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpv8jogkme/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpv8jogkme/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpv8jogkme/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpv8jogkme/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpv8jogkme/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpv8jogkme/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpv8jogkme/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpv8jogkme/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpv8jogkme/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpv8jogkme/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpv8jogkme/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpv8jogkme/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 491.86it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.43 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,0\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 160,112,100 , use origin iz00,iy00,ix00 = 136,112,100 , end iz1,iy1,ix1 = 256,232,220\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.3507725694444446\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 21.10783448807152. Calculating stats.\n",
      "INFO:root:Lower bound: -51.00190123733973, upper bound: 57.70344637622862\n",
      "INFO:root:Number of voxels above upper bound to be clipped 9316 - percentage 0.539%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 16947 - percentage 0.981%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.90it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpgoziq_66/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpgoziq_66/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.51it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpgoziq_66/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpgoziq_66/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.91it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpgoziq_66/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpgoziq_66/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.01it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpgoziq_66/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpgoziq_66/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 101.41it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpgoziq_66/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpgoziq_66/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.30it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpgoziq_66/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpgoziq_66/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.96it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpgoziq_66/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpgoziq_66/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.44it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpgoziq_66/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpgoziq_66/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.43it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpgoziq_66/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpgoziq_66/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.22it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpgoziq_66/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpgoziq_66/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.72it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpgoziq_66/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpgoziq_66/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.71it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpgoziq_66/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpgoziq_66/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpgoziq_66/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpgoziq_66/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpgoziq_66/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpgoziq_66/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpgoziq_66/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpgoziq_66/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpgoziq_66/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpgoziq_66/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpgoziq_66/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpgoziq_66/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpgoziq_66/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpgoziq_66/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpgoziq_66/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpgoziq_66/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpgoziq_66/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpgoziq_66/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpgoziq_66/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpgoziq_66/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpgoziq_66/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpgoziq_66/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpgoziq_66/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpgoziq_66/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpgoziq_66/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpgoziq_66/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 468.35it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.53 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 160,112,200 , use origin iz00,iy00,ix00 = 136,112,136 , end iz1,iy1,ix1 = 256,232,256\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.476579861111111\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 21.3057623512388. Calculating stats.\n",
      "INFO:root:Lower bound: -51.385758193328805, upper bound: 58.33891791555103\n",
      "INFO:root:Number of voxels above upper bound to be clipped 9708 - percentage 0.562%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 17030 - percentage 0.986%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.18it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpo14cbaw8/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpo14cbaw8/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.23it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpo14cbaw8/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpo14cbaw8/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.16it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpo14cbaw8/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpo14cbaw8/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.72it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpo14cbaw8/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpo14cbaw8/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.32it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpo14cbaw8/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpo14cbaw8/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 101.13it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpo14cbaw8/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpo14cbaw8/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.96it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpo14cbaw8/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpo14cbaw8/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 100.87it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpo14cbaw8/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpo14cbaw8/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.69it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpo14cbaw8/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpo14cbaw8/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 101.90it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpo14cbaw8/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpo14cbaw8/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 87.41it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpo14cbaw8/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpo14cbaw8/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 86.39it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpo14cbaw8/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpo14cbaw8/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpo14cbaw8/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpo14cbaw8/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpo14cbaw8/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpo14cbaw8/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpo14cbaw8/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpo14cbaw8/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpo14cbaw8/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpo14cbaw8/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpo14cbaw8/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpo14cbaw8/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpo14cbaw8/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpo14cbaw8/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpo14cbaw8/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpo14cbaw8/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpo14cbaw8/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpo14cbaw8/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpo14cbaw8/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpo14cbaw8/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpo14cbaw8/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpo14cbaw8/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpo14cbaw8/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpo14cbaw8/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpo14cbaw8/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpo14cbaw8/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 435.75it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.43 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 160,168,0 , use origin iz00,iy00,ix00 = 136,136,0 , end iz1,iy1,ix1 = 256,256,120\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.531992476851852\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 21.62009004632161. Calculating stats.\n",
      "INFO:root:Lower bound: -52.1397393924263, upper bound: 59.20372434613001\n",
      "INFO:root:Number of voxels above upper bound to be clipped 9034 - percentage 0.523%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 19687 - percentage 1.139%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.54it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpms6zbdx3/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpms6zbdx3/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 89.14it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpms6zbdx3/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpms6zbdx3/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.04it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpms6zbdx3/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpms6zbdx3/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.48it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpms6zbdx3/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpms6zbdx3/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.20it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpms6zbdx3/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpms6zbdx3/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.68it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpms6zbdx3/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpms6zbdx3/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.50it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpms6zbdx3/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpms6zbdx3/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 101.47it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpms6zbdx3/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpms6zbdx3/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.19it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpms6zbdx3/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpms6zbdx3/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.25it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpms6zbdx3/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpms6zbdx3/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 102.30it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpms6zbdx3/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpms6zbdx3/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.47it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpms6zbdx3/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpms6zbdx3/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpms6zbdx3/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpms6zbdx3/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpms6zbdx3/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpms6zbdx3/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpms6zbdx3/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpms6zbdx3/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpms6zbdx3/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpms6zbdx3/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpms6zbdx3/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpms6zbdx3/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpms6zbdx3/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpms6zbdx3/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpms6zbdx3/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpms6zbdx3/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpms6zbdx3/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpms6zbdx3/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpms6zbdx3/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpms6zbdx3/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpms6zbdx3/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpms6zbdx3/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpms6zbdx3/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpms6zbdx3/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpms6zbdx3/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpms6zbdx3/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 527.61it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.43 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,0\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 160,168,100 , use origin iz00,iy00,ix00 = 136,136,100 , end iz1,iy1,ix1 = 256,256,220\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.3200208333333334\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 21.166751035473386. Calculating stats.\n",
      "INFO:root:Lower bound: -51.18436308301064, upper bound: 57.8244047496773\n",
      "INFO:root:Number of voxels above upper bound to be clipped 9386 - percentage 0.543%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 17218 - percentage 0.996%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.82it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpybg09kn3/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpybg09kn3/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.22it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpybg09kn3/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpybg09kn3/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 89.23it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpybg09kn3/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpybg09kn3/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.10it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpybg09kn3/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpybg09kn3/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.72it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpybg09kn3/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpybg09kn3/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 89.74it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpybg09kn3/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpybg09kn3/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.85it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpybg09kn3/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpybg09kn3/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.98it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpybg09kn3/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpybg09kn3/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.47it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpybg09kn3/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpybg09kn3/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.31it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpybg09kn3/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpybg09kn3/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 100.07it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpybg09kn3/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpybg09kn3/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.42it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpybg09kn3/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpybg09kn3/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpybg09kn3/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpybg09kn3/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpybg09kn3/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpybg09kn3/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpybg09kn3/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpybg09kn3/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpybg09kn3/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpybg09kn3/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpybg09kn3/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpybg09kn3/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpybg09kn3/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpybg09kn3/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpybg09kn3/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpybg09kn3/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpybg09kn3/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpybg09kn3/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpybg09kn3/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpybg09kn3/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpybg09kn3/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpybg09kn3/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpybg09kn3/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpybg09kn3/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpybg09kn3/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpybg09kn3/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 451.70it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.34 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 160,168,200 , use origin iz00,iy00,ix00 = 136,136,136 , end iz1,iy1,ix1 = 256,256,256\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.445274884259259\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 21.15562393651363. Calculating stats.\n",
      "INFO:root:Lower bound: -51.03045675226335, upper bound: 57.92100652078186\n",
      "INFO:root:Number of voxels above upper bound to be clipped 9391 - percentage 0.543%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 16635 - percentage 0.963%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.32it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpvurmkdu3/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpvurmkdu3/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.63it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpvurmkdu3/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpvurmkdu3/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.10it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpvurmkdu3/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpvurmkdu3/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.09it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpvurmkdu3/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpvurmkdu3/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.64it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpvurmkdu3/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpvurmkdu3/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.69it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpvurmkdu3/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpvurmkdu3/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.18it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpvurmkdu3/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpvurmkdu3/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.40it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpvurmkdu3/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpvurmkdu3/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.04it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpvurmkdu3/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpvurmkdu3/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.60it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpvurmkdu3/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpvurmkdu3/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.80it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpvurmkdu3/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpvurmkdu3/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.47it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpvurmkdu3/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpvurmkdu3/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpvurmkdu3/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpvurmkdu3/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpvurmkdu3/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpvurmkdu3/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpvurmkdu3/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpvurmkdu3/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpvurmkdu3/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpvurmkdu3/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpvurmkdu3/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpvurmkdu3/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpvurmkdu3/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpvurmkdu3/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpvurmkdu3/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpvurmkdu3/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpvurmkdu3/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpvurmkdu3/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpvurmkdu3/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpvurmkdu3/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpvurmkdu3/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpvurmkdu3/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpvurmkdu3/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpvurmkdu3/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpvurmkdu3/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpvurmkdu3/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 358.61it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.44 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 160,224,0 , use origin iz00,iy00,ix00 = 136,136,0 , end iz1,iy1,ix1 = 256,256,120\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.531992476851852\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 21.62009004632161. Calculating stats.\n",
      "INFO:root:Lower bound: -52.1397393924263, upper bound: 59.20372434613001\n",
      "INFO:root:Number of voxels above upper bound to be clipped 9034 - percentage 0.523%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 19687 - percentage 1.139%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.39it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmprbb50itt/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmprbb50itt/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 103.47it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmprbb50itt/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmprbb50itt/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 101.24it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmprbb50itt/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmprbb50itt/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 103.79it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmprbb50itt/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmprbb50itt/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 103.24it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmprbb50itt/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmprbb50itt/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.87it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmprbb50itt/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmprbb50itt/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.29it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmprbb50itt/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmprbb50itt/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 101.73it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmprbb50itt/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmprbb50itt/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.34it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmprbb50itt/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmprbb50itt/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.82it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmprbb50itt/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmprbb50itt/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 103.22it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmprbb50itt/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmprbb50itt/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.95it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmprbb50itt/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmprbb50itt/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmprbb50itt/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmprbb50itt/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmprbb50itt/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmprbb50itt/pred_0_YX_90.h5   \n",
      "4    /tmp/tmprbb50itt/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmprbb50itt/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmprbb50itt/pred_0_YX_180.h5   \n",
      "7   /tmp/tmprbb50itt/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmprbb50itt/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmprbb50itt/pred_0_YX_270.h5   \n",
      "10  /tmp/tmprbb50itt/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmprbb50itt/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmprbb50itt/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmprbb50itt/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmprbb50itt/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmprbb50itt/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmprbb50itt/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmprbb50itt/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmprbb50itt/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmprbb50itt/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmprbb50itt/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmprbb50itt/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmprbb50itt/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmprbb50itt/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 515.31it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.53 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,0\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 160,224,100 , use origin iz00,iy00,ix00 = 136,136,100 , end iz1,iy1,ix1 = 256,256,220\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.3200208333333334\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 21.166751035473386. Calculating stats.\n",
      "INFO:root:Lower bound: -51.18436308301064, upper bound: 57.8244047496773\n",
      "INFO:root:Number of voxels above upper bound to be clipped 9386 - percentage 0.543%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 17218 - percentage 0.996%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.03it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpvjn3ch83/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpvjn3ch83/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.83it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpvjn3ch83/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpvjn3ch83/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.09it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpvjn3ch83/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpvjn3ch83/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.87it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpvjn3ch83/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpvjn3ch83/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.67it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpvjn3ch83/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpvjn3ch83/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 86.98it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpvjn3ch83/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpvjn3ch83/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.70it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpvjn3ch83/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpvjn3ch83/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.04it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpvjn3ch83/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpvjn3ch83/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.38it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpvjn3ch83/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpvjn3ch83/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.14it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpvjn3ch83/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpvjn3ch83/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.24it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpvjn3ch83/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpvjn3ch83/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.09it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpvjn3ch83/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpvjn3ch83/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpvjn3ch83/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpvjn3ch83/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpvjn3ch83/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpvjn3ch83/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpvjn3ch83/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpvjn3ch83/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpvjn3ch83/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpvjn3ch83/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpvjn3ch83/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpvjn3ch83/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpvjn3ch83/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpvjn3ch83/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpvjn3ch83/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpvjn3ch83/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpvjn3ch83/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpvjn3ch83/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpvjn3ch83/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpvjn3ch83/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpvjn3ch83/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpvjn3ch83/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpvjn3ch83/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpvjn3ch83/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpvjn3ch83/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpvjn3ch83/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 484.92it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.43 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 160,224,200 , use origin iz00,iy00,ix00 = 136,136,136 , end iz1,iy1,ix1 = 256,256,256\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.445274884259259\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 21.15562393651363. Calculating stats.\n",
      "INFO:root:Lower bound: -51.03045675226335, upper bound: 57.92100652078186\n",
      "INFO:root:Number of voxels above upper bound to be clipped 9391 - percentage 0.543%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 16635 - percentage 0.963%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.01it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpg36gmwk4/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpg36gmwk4/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.23it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpg36gmwk4/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpg36gmwk4/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.67it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpg36gmwk4/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpg36gmwk4/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 103.34it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpg36gmwk4/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpg36gmwk4/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.38it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpg36gmwk4/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpg36gmwk4/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 87.83it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpg36gmwk4/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpg36gmwk4/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 103.19it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpg36gmwk4/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpg36gmwk4/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.46it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpg36gmwk4/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpg36gmwk4/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 83.73it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpg36gmwk4/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpg36gmwk4/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.26it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpg36gmwk4/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpg36gmwk4/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.91it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpg36gmwk4/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpg36gmwk4/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.51it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpg36gmwk4/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpg36gmwk4/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpg36gmwk4/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpg36gmwk4/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpg36gmwk4/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpg36gmwk4/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpg36gmwk4/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpg36gmwk4/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpg36gmwk4/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpg36gmwk4/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpg36gmwk4/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpg36gmwk4/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpg36gmwk4/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpg36gmwk4/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpg36gmwk4/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpg36gmwk4/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpg36gmwk4/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpg36gmwk4/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpg36gmwk4/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpg36gmwk4/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpg36gmwk4/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpg36gmwk4/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpg36gmwk4/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpg36gmwk4/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpg36gmwk4/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpg36gmwk4/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 294.73it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.64 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 240,0,0 , use origin iz00,iy00,ix00 = 136,0,0 , end iz1,iy1,ix1 = 256,120,120\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.333677662037037\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 22.539315883384873. Calculating stats.\n",
      "INFO:root:Lower bound: -54.70506073767901, upper bound: 61.37241606175309\n",
      "INFO:root:Number of voxels above upper bound to be clipped 7790 - percentage 0.451%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 18477 - percentage 1.069%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 85.57it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpjy8z1d71/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpjy8z1d71/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 77.74it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpjy8z1d71/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpjy8z1d71/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 78.24it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpjy8z1d71/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpjy8z1d71/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 73.54it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpjy8z1d71/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpjy8z1d71/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.00it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpjy8z1d71/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpjy8z1d71/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 80.07it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpjy8z1d71/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpjy8z1d71/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 80.93it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpjy8z1d71/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpjy8z1d71/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 86.36it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpjy8z1d71/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpjy8z1d71/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 82.24it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpjy8z1d71/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpjy8z1d71/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 79.49it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpjy8z1d71/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpjy8z1d71/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 75.75it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpjy8z1d71/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpjy8z1d71/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 80.94it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpjy8z1d71/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpjy8z1d71/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpjy8z1d71/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpjy8z1d71/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpjy8z1d71/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpjy8z1d71/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpjy8z1d71/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpjy8z1d71/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpjy8z1d71/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpjy8z1d71/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpjy8z1d71/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpjy8z1d71/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpjy8z1d71/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpjy8z1d71/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpjy8z1d71/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpjy8z1d71/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpjy8z1d71/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpjy8z1d71/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpjy8z1d71/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpjy8z1d71/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpjy8z1d71/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpjy8z1d71/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpjy8z1d71/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpjy8z1d71/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpjy8z1d71/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpjy8z1d71/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 385.15it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.63 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,0,0\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 240,0,100 , use origin iz00,iy00,ix00 = 136,0,100 , end iz1,iy1,ix1 = 256,120,220\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.364895833333333\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 22.21822904115583. Calculating stats.\n",
      "INFO:root:Lower bound: -53.84704394764293, upper bound: 60.5768356143096\n",
      "INFO:root:Number of voxels above upper bound to be clipped 9003 - percentage 0.521%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 17360 - percentage 1.005%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 86.91it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpyyrfffqe/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpyyrfffqe/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 79.97it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpyyrfffqe/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpyyrfffqe/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 81.63it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpyyrfffqe/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpyyrfffqe/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 73.36it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpyyrfffqe/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpyyrfffqe/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 30.45it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpyyrfffqe/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpyyrfffqe/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:01<00:00, 29.76it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpyyrfffqe/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpyyrfffqe/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:01<00:00, 29.55it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpyyrfffqe/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpyyrfffqe/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 30.53it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpyyrfffqe/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpyyrfffqe/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:01<00:00, 26.91it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpyyrfffqe/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpyyrfffqe/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 32.09it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpyyrfffqe/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpyyrfffqe/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 32.31it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpyyrfffqe/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpyyrfffqe/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:01<00:00, 27.65it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpyyrfffqe/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpyyrfffqe/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpyyrfffqe/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpyyrfffqe/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpyyrfffqe/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpyyrfffqe/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpyyrfffqe/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpyyrfffqe/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpyyrfffqe/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpyyrfffqe/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpyyrfffqe/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpyyrfffqe/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpyyrfffqe/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpyyrfffqe/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpyyrfffqe/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpyyrfffqe/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpyyrfffqe/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpyyrfffqe/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpyyrfffqe/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpyyrfffqe/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpyyrfffqe/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpyyrfffqe/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpyyrfffqe/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpyyrfffqe/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpyyrfffqe/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpyyrfffqe/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 213.20it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 4.28 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,0,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 240,0,200 , use origin iz00,iy00,ix00 = 136,0,136 , end iz1,iy1,ix1 = 256,120,256\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.407494212962963\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 22.119019579766775. Calculating stats.\n",
      "INFO:root:Lower bound: -53.54898120493648, upper bound: 60.363969630862414\n",
      "INFO:root:Number of voxels above upper bound to be clipped 8686 - percentage 0.503%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 16952 - percentage 0.981%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.94it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp0u9iuzjl/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp0u9iuzjl/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.15it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp0u9iuzjl/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp0u9iuzjl/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.30it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp0u9iuzjl/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp0u9iuzjl/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.89it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp0u9iuzjl/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp0u9iuzjl/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.11it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp0u9iuzjl/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp0u9iuzjl/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.55it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp0u9iuzjl/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp0u9iuzjl/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 100.00it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp0u9iuzjl/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp0u9iuzjl/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.52it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp0u9iuzjl/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp0u9iuzjl/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.92it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp0u9iuzjl/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp0u9iuzjl/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 101.97it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp0u9iuzjl/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp0u9iuzjl/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 104.23it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp0u9iuzjl/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp0u9iuzjl/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.28it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp0u9iuzjl/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp0u9iuzjl/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmp0u9iuzjl/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmp0u9iuzjl/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmp0u9iuzjl/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmp0u9iuzjl/pred_0_YX_90.h5   \n",
      "4    /tmp/tmp0u9iuzjl/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmp0u9iuzjl/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmp0u9iuzjl/pred_0_YX_180.h5   \n",
      "7   /tmp/tmp0u9iuzjl/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmp0u9iuzjl/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmp0u9iuzjl/pred_0_YX_270.h5   \n",
      "10  /tmp/tmp0u9iuzjl/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmp0u9iuzjl/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmp0u9iuzjl/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmp0u9iuzjl/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmp0u9iuzjl/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmp0u9iuzjl/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmp0u9iuzjl/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmp0u9iuzjl/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmp0u9iuzjl/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmp0u9iuzjl/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmp0u9iuzjl/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmp0u9iuzjl/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmp0u9iuzjl/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmp0u9iuzjl/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 499.88it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.43 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,0,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 240,56,0 , use origin iz00,iy00,ix00 = 136,56,0 , end iz1,iy1,ix1 = 256,176,120\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.4173391203703702\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 22.25838237968924. Calculating stats.\n",
      "INFO:root:Lower bound: -53.897995507329426, upper bound: 60.73267374807017\n",
      "INFO:root:Number of voxels above upper bound to be clipped 9911 - percentage 0.574%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 18734 - percentage 1.084%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.50it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeti_phu3/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeti_phu3/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.30it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeti_phu3/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeti_phu3/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.46it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeti_phu3/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeti_phu3/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.51it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeti_phu3/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeti_phu3/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.49it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeti_phu3/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeti_phu3/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 86.86it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeti_phu3/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeti_phu3/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.83it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeti_phu3/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeti_phu3/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.27it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeti_phu3/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeti_phu3/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.24it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeti_phu3/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeti_phu3/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.17it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeti_phu3/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeti_phu3/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.08it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeti_phu3/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeti_phu3/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.01it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpeti_phu3/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpeti_phu3/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpeti_phu3/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpeti_phu3/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpeti_phu3/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpeti_phu3/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpeti_phu3/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpeti_phu3/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpeti_phu3/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpeti_phu3/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpeti_phu3/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpeti_phu3/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpeti_phu3/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpeti_phu3/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpeti_phu3/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpeti_phu3/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpeti_phu3/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpeti_phu3/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpeti_phu3/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpeti_phu3/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpeti_phu3/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpeti_phu3/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpeti_phu3/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpeti_phu3/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpeti_phu3/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpeti_phu3/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 408.80it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.43 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,0\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 240,56,100 , use origin iz00,iy00,ix00 = 136,56,100 , end iz1,iy1,ix1 = 256,176,220\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.4573188657407408\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 21.469374507579488. Calculating stats.\n",
      "INFO:root:Lower bound: -51.82632049127645, upper bound: 58.740958222757925\n",
      "INFO:root:Number of voxels above upper bound to be clipped 10190 - percentage 0.590%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 18540 - percentage 1.073%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.35it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpptm29pf1/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpptm29pf1/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 102.25it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpptm29pf1/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpptm29pf1/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.33it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpptm29pf1/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpptm29pf1/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.90it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpptm29pf1/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpptm29pf1/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.71it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpptm29pf1/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpptm29pf1/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.59it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpptm29pf1/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpptm29pf1/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 100.01it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpptm29pf1/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpptm29pf1/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.02it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpptm29pf1/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpptm29pf1/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.46it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpptm29pf1/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpptm29pf1/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.38it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpptm29pf1/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpptm29pf1/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.52it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpptm29pf1/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpptm29pf1/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.20it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpptm29pf1/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpptm29pf1/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpptm29pf1/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpptm29pf1/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpptm29pf1/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpptm29pf1/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpptm29pf1/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpptm29pf1/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpptm29pf1/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpptm29pf1/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpptm29pf1/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpptm29pf1/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpptm29pf1/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpptm29pf1/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpptm29pf1/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpptm29pf1/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpptm29pf1/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpptm29pf1/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpptm29pf1/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpptm29pf1/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpptm29pf1/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpptm29pf1/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpptm29pf1/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpptm29pf1/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpptm29pf1/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpptm29pf1/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 323.43it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.43 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 240,56,200 , use origin iz00,iy00,ix00 = 136,56,136 , end iz1,iy1,ix1 = 256,176,256\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.528470486111111\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 21.625563621127206. Calculating stats.\n",
      "INFO:root:Lower bound: -52.15735583829145, upper bound: 59.21429681051367\n",
      "INFO:root:Number of voxels above upper bound to be clipped 7921 - percentage 0.458%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 18653 - percentage 1.079%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.68it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3ku2thkl/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3ku2thkl/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.58it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3ku2thkl/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3ku2thkl/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 86.65it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3ku2thkl/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3ku2thkl/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 101.87it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3ku2thkl/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3ku2thkl/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 101.48it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3ku2thkl/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3ku2thkl/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 100.19it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3ku2thkl/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3ku2thkl/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 103.42it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3ku2thkl/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3ku2thkl/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 103.06it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3ku2thkl/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3ku2thkl/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 100.29it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3ku2thkl/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3ku2thkl/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 102.35it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3ku2thkl/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3ku2thkl/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 102.60it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3ku2thkl/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3ku2thkl/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.50it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmp3ku2thkl/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmp3ku2thkl/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmp3ku2thkl/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmp3ku2thkl/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmp3ku2thkl/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmp3ku2thkl/pred_0_YX_90.h5   \n",
      "4    /tmp/tmp3ku2thkl/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmp3ku2thkl/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmp3ku2thkl/pred_0_YX_180.h5   \n",
      "7   /tmp/tmp3ku2thkl/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmp3ku2thkl/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmp3ku2thkl/pred_0_YX_270.h5   \n",
      "10  /tmp/tmp3ku2thkl/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmp3ku2thkl/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmp3ku2thkl/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmp3ku2thkl/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmp3ku2thkl/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmp3ku2thkl/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmp3ku2thkl/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmp3ku2thkl/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmp3ku2thkl/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmp3ku2thkl/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmp3ku2thkl/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmp3ku2thkl/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmp3ku2thkl/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmp3ku2thkl/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 508.80it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.45 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 240,112,0 , use origin iz00,iy00,ix00 = 136,112,0 , end iz1,iy1,ix1 = 256,232,120\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.5085677083333335\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 21.823908631062555. Calculating stats.\n",
      "INFO:root:Lower bound: -52.68799701665275, upper bound: 59.70513243331941\n",
      "INFO:root:Number of voxels above upper bound to be clipped 9349 - percentage 0.541%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 21101 - percentage 1.221%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.29it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpki97pga2/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpki97pga2/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.51it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpki97pga2/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpki97pga2/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 88.61it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpki97pga2/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpki97pga2/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.14it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpki97pga2/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpki97pga2/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.74it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpki97pga2/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpki97pga2/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.28it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpki97pga2/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpki97pga2/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 102.87it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpki97pga2/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpki97pga2/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.96it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpki97pga2/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpki97pga2/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.75it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpki97pga2/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpki97pga2/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.64it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpki97pga2/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpki97pga2/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.03it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpki97pga2/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpki97pga2/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.13it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpki97pga2/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpki97pga2/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpki97pga2/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpki97pga2/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpki97pga2/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpki97pga2/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpki97pga2/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpki97pga2/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpki97pga2/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpki97pga2/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpki97pga2/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpki97pga2/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpki97pga2/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpki97pga2/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpki97pga2/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpki97pga2/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpki97pga2/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpki97pga2/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpki97pga2/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpki97pga2/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpki97pga2/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpki97pga2/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpki97pga2/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpki97pga2/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpki97pga2/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpki97pga2/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 490.90it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.33 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,0\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 240,112,100 , use origin iz00,iy00,ix00 = 136,112,100 , end iz1,iy1,ix1 = 256,232,220\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.3507725694444446\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 21.10783448807152. Calculating stats.\n",
      "INFO:root:Lower bound: -51.00190123733973, upper bound: 57.70344637622862\n",
      "INFO:root:Number of voxels above upper bound to be clipped 9316 - percentage 0.539%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 16947 - percentage 0.981%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.93it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpkb22eoow/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpkb22eoow/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.05it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpkb22eoow/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpkb22eoow/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 83.55it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpkb22eoow/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpkb22eoow/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.21it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpkb22eoow/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpkb22eoow/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.24it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpkb22eoow/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpkb22eoow/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 89.75it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpkb22eoow/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpkb22eoow/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.01it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpkb22eoow/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpkb22eoow/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.76it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpkb22eoow/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpkb22eoow/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.41it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpkb22eoow/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpkb22eoow/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.41it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpkb22eoow/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpkb22eoow/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 86.62it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpkb22eoow/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpkb22eoow/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.04it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpkb22eoow/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpkb22eoow/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpkb22eoow/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpkb22eoow/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpkb22eoow/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpkb22eoow/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpkb22eoow/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpkb22eoow/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpkb22eoow/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpkb22eoow/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpkb22eoow/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpkb22eoow/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpkb22eoow/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpkb22eoow/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpkb22eoow/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpkb22eoow/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpkb22eoow/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpkb22eoow/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpkb22eoow/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpkb22eoow/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpkb22eoow/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpkb22eoow/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpkb22eoow/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpkb22eoow/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpkb22eoow/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpkb22eoow/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 493.68it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.43 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 240,112,200 , use origin iz00,iy00,ix00 = 136,112,136 , end iz1,iy1,ix1 = 256,232,256\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.476579861111111\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 21.3057623512388. Calculating stats.\n",
      "INFO:root:Lower bound: -51.385758193328805, upper bound: 58.33891791555103\n",
      "INFO:root:Number of voxels above upper bound to be clipped 9708 - percentage 0.562%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 17030 - percentage 0.986%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.56it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpxyxr5tcr/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpxyxr5tcr/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.43it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpxyxr5tcr/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpxyxr5tcr/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.57it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpxyxr5tcr/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpxyxr5tcr/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 101.67it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpxyxr5tcr/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpxyxr5tcr/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 101.94it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpxyxr5tcr/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpxyxr5tcr/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.93it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpxyxr5tcr/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpxyxr5tcr/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 100.84it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpxyxr5tcr/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpxyxr5tcr/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.87it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpxyxr5tcr/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpxyxr5tcr/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.62it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpxyxr5tcr/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpxyxr5tcr/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 103.35it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpxyxr5tcr/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpxyxr5tcr/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 101.32it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpxyxr5tcr/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpxyxr5tcr/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.88it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpxyxr5tcr/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpxyxr5tcr/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpxyxr5tcr/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpxyxr5tcr/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpxyxr5tcr/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpxyxr5tcr/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpxyxr5tcr/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpxyxr5tcr/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpxyxr5tcr/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpxyxr5tcr/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpxyxr5tcr/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpxyxr5tcr/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpxyxr5tcr/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpxyxr5tcr/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpxyxr5tcr/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpxyxr5tcr/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpxyxr5tcr/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpxyxr5tcr/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpxyxr5tcr/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpxyxr5tcr/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpxyxr5tcr/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpxyxr5tcr/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpxyxr5tcr/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpxyxr5tcr/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpxyxr5tcr/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpxyxr5tcr/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 453.78it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.43 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 240,168,0 , use origin iz00,iy00,ix00 = 136,136,0 , end iz1,iy1,ix1 = 256,256,120\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.531992476851852\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 21.62009004632161. Calculating stats.\n",
      "INFO:root:Lower bound: -52.1397393924263, upper bound: 59.20372434613001\n",
      "INFO:root:Number of voxels above upper bound to be clipped 9034 - percentage 0.523%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 19687 - percentage 1.139%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.91it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpjtsmmst1/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpjtsmmst1/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.01it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpjtsmmst1/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpjtsmmst1/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.54it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpjtsmmst1/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpjtsmmst1/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.54it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpjtsmmst1/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpjtsmmst1/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.07it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpjtsmmst1/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpjtsmmst1/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.79it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpjtsmmst1/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpjtsmmst1/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.40it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpjtsmmst1/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpjtsmmst1/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.92it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpjtsmmst1/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpjtsmmst1/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.28it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpjtsmmst1/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpjtsmmst1/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.88it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpjtsmmst1/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpjtsmmst1/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 101.91it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpjtsmmst1/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpjtsmmst1/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.12it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpjtsmmst1/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpjtsmmst1/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpjtsmmst1/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpjtsmmst1/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpjtsmmst1/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpjtsmmst1/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpjtsmmst1/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpjtsmmst1/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpjtsmmst1/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpjtsmmst1/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpjtsmmst1/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpjtsmmst1/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpjtsmmst1/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpjtsmmst1/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpjtsmmst1/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpjtsmmst1/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpjtsmmst1/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpjtsmmst1/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpjtsmmst1/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpjtsmmst1/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpjtsmmst1/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpjtsmmst1/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpjtsmmst1/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpjtsmmst1/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpjtsmmst1/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpjtsmmst1/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 510.93it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.43 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,0\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 240,168,100 , use origin iz00,iy00,ix00 = 136,136,100 , end iz1,iy1,ix1 = 256,256,220\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.3200208333333334\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 21.166751035473386. Calculating stats.\n",
      "INFO:root:Lower bound: -51.18436308301064, upper bound: 57.8244047496773\n",
      "INFO:root:Number of voxels above upper bound to be clipped 9386 - percentage 0.543%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 17218 - percentage 0.996%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.22it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpv4x1xvis/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpv4x1xvis/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.86it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpv4x1xvis/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpv4x1xvis/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.58it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpv4x1xvis/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpv4x1xvis/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.24it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpv4x1xvis/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpv4x1xvis/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.74it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpv4x1xvis/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpv4x1xvis/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.79it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpv4x1xvis/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpv4x1xvis/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 100.56it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpv4x1xvis/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpv4x1xvis/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.07it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpv4x1xvis/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpv4x1xvis/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.25it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpv4x1xvis/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpv4x1xvis/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.89it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpv4x1xvis/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpv4x1xvis/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.36it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpv4x1xvis/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpv4x1xvis/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.58it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpv4x1xvis/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpv4x1xvis/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpv4x1xvis/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpv4x1xvis/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpv4x1xvis/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpv4x1xvis/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpv4x1xvis/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpv4x1xvis/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpv4x1xvis/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpv4x1xvis/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpv4x1xvis/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpv4x1xvis/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpv4x1xvis/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpv4x1xvis/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpv4x1xvis/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpv4x1xvis/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpv4x1xvis/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpv4x1xvis/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpv4x1xvis/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpv4x1xvis/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpv4x1xvis/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpv4x1xvis/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpv4x1xvis/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpv4x1xvis/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpv4x1xvis/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpv4x1xvis/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 480.68it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.33 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 240,168,200 , use origin iz00,iy00,ix00 = 136,136,136 , end iz1,iy1,ix1 = 256,256,256\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.445274884259259\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 21.15562393651363. Calculating stats.\n",
      "INFO:root:Lower bound: -51.03045675226335, upper bound: 57.92100652078186\n",
      "INFO:root:Number of voxels above upper bound to be clipped 9391 - percentage 0.543%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 16635 - percentage 0.963%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.80it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpl_a0u24c/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpl_a0u24c/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 100.43it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpl_a0u24c/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpl_a0u24c/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.36it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpl_a0u24c/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpl_a0u24c/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.17it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpl_a0u24c/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpl_a0u24c/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.04it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpl_a0u24c/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpl_a0u24c/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 87.99it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpl_a0u24c/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpl_a0u24c/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.82it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpl_a0u24c/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpl_a0u24c/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 100.58it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpl_a0u24c/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpl_a0u24c/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.05it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpl_a0u24c/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpl_a0u24c/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.31it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpl_a0u24c/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpl_a0u24c/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 102.01it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpl_a0u24c/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpl_a0u24c/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.60it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpl_a0u24c/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpl_a0u24c/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpl_a0u24c/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpl_a0u24c/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpl_a0u24c/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpl_a0u24c/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpl_a0u24c/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpl_a0u24c/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpl_a0u24c/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpl_a0u24c/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpl_a0u24c/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpl_a0u24c/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpl_a0u24c/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpl_a0u24c/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpl_a0u24c/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpl_a0u24c/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpl_a0u24c/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpl_a0u24c/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpl_a0u24c/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpl_a0u24c/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpl_a0u24c/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpl_a0u24c/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpl_a0u24c/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpl_a0u24c/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpl_a0u24c/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpl_a0u24c/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 477.82it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.34 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 240,224,0 , use origin iz00,iy00,ix00 = 136,136,0 , end iz1,iy1,ix1 = 256,256,120\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.531992476851852\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 21.62009004632161. Calculating stats.\n",
      "INFO:root:Lower bound: -52.1397393924263, upper bound: 59.20372434613001\n",
      "INFO:root:Number of voxels above upper bound to be clipped 9034 - percentage 0.523%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 19687 - percentage 1.139%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 100.40it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpedyi3aq8/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpedyi3aq8/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 86.74it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpedyi3aq8/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpedyi3aq8/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 92.49it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpedyi3aq8/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpedyi3aq8/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.25it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpedyi3aq8/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpedyi3aq8/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 89.13it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpedyi3aq8/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpedyi3aq8/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 93.11it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpedyi3aq8/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpedyi3aq8/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.07it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpedyi3aq8/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpedyi3aq8/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.22it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpedyi3aq8/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpedyi3aq8/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.66it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpedyi3aq8/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpedyi3aq8/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.24it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpedyi3aq8/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpedyi3aq8/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.94it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpedyi3aq8/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpedyi3aq8/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 90.36it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpedyi3aq8/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpedyi3aq8/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpedyi3aq8/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpedyi3aq8/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpedyi3aq8/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpedyi3aq8/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpedyi3aq8/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpedyi3aq8/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpedyi3aq8/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpedyi3aq8/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpedyi3aq8/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpedyi3aq8/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpedyi3aq8/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpedyi3aq8/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpedyi3aq8/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpedyi3aq8/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpedyi3aq8/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpedyi3aq8/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpedyi3aq8/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpedyi3aq8/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpedyi3aq8/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpedyi3aq8/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpedyi3aq8/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpedyi3aq8/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpedyi3aq8/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpedyi3aq8/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 471.01it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.43 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,0\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 240,224,100 , use origin iz00,iy00,ix00 = 136,136,100 , end iz1,iy1,ix1 = 256,256,220\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.3200208333333334\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 21.166751035473386. Calculating stats.\n",
      "INFO:root:Lower bound: -51.18436308301064, upper bound: 57.8244047496773\n",
      "INFO:root:Number of voxels above upper bound to be clipped 9386 - percentage 0.543%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 17218 - percentage 0.996%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.33it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpkblbu37v/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpkblbu37v/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.34it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpkblbu37v/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpkblbu37v/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.94it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpkblbu37v/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpkblbu37v/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.84it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpkblbu37v/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpkblbu37v/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.71it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpkblbu37v/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpkblbu37v/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.93it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpkblbu37v/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpkblbu37v/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.91it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpkblbu37v/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpkblbu37v/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 100.00it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpkblbu37v/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpkblbu37v/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.36it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpkblbu37v/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpkblbu37v/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.67it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpkblbu37v/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpkblbu37v/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.09it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpkblbu37v/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpkblbu37v/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 87.45it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpkblbu37v/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpkblbu37v/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpkblbu37v/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpkblbu37v/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpkblbu37v/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpkblbu37v/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpkblbu37v/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpkblbu37v/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpkblbu37v/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpkblbu37v/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpkblbu37v/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpkblbu37v/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpkblbu37v/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpkblbu37v/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpkblbu37v/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpkblbu37v/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpkblbu37v/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpkblbu37v/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpkblbu37v/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpkblbu37v/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpkblbu37v/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpkblbu37v/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpkblbu37v/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpkblbu37v/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpkblbu37v/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpkblbu37v/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 448.89it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.44 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: New block, intended origin iz0,iy0,ix0 = 240,224,200 , use origin iz00,iy00,ix00 = 136,136,136 , end iz1,iy1,ix1 = 256,256,256\n",
      "INFO:root:BLOCK: Start calculation with this block\n",
      "INFO:root:Setting up NN1 prediction\n",
      "INFO:root:number of data sets to predict: 1\n",
      "INFO:root:Data to predict index:0\n",
      "INFO:root:Calculating mean of data...\n",
      "INFO:root:Mean value: 3.445274884259259\n",
      "INFO:root:Calculating standard deviation.\n",
      "INFO:root:Std dev: 21.15562393651363. Calculating stats.\n",
      "INFO:root:Lower bound: -51.03045675226335, upper bound: 57.92100652078186\n",
      "INFO:root:Number of voxels above upper bound to be clipped 9391 - percentage 0.543%\n",
      "INFO:root:Number of voxels below lower bound to be clipped 16635 - percentage 0.963%\n",
      "INFO:root:Rescaling intensities.\n",
      "INFO:root:Data is already in integer dtype, converting to float for rescaling.\n",
      "INFO:root:Converting to uint8.\n",
      "INFO:root:Loading model dictionary from file.\n",
      "INFO:root:Sending the U-Net model to device 0\n",
      "INFO:root:Loading in the saved weights.\n",
      "INFO:root:Volume to be rotated by 0 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 101.21it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpyockcb_v/pred_0_YX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpyockcb_v/pred_0_YX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 102.88it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpyockcb_v/pred_0_ZX_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpyockcb_v/pred_0_ZX_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 99.08it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpyockcb_v/pred_0_ZY_0.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpyockcb_v/pred_0_ZY_labels_0.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 90 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 87.32it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpyockcb_v/pred_0_YX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpyockcb_v/pred_0_YX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 89.41it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpyockcb_v/pred_0_ZX_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpyockcb_v/pred_0_ZX_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.03it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpyockcb_v/pred_0_ZY_90.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpyockcb_v/pred_0_ZY_labels_90.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 180 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 96.18it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpyockcb_v/pred_0_YX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpyockcb_v/pred_0_YX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 94.11it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpyockcb_v/pred_0_ZX_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpyockcb_v/pred_0_ZX_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 98.71it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpyockcb_v/pred_0_ZY_180.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpyockcb_v/pred_0_ZY_labels_180.h5 with kwargs {}.\n",
      "INFO:root:Volume to be rotated by 270 degrees\n",
      "INFO:root:Predicting YX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 97.93it/s] \n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpyockcb_v/pred_0_YX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpyockcb_v/pred_0_YX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZX slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 91.74it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpyockcb_v/pred_0_ZX_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpyockcb_v/pred_0_ZX_labels_270.h5 with kwargs {}.\n",
      "INFO:root:Predicting ZY slices:\n",
      "INFO:root:Free GPU memory is 31.66 GB. Batch size will be 4.\n",
      "INFO:root:Predicting segmentation for volume of shape (120, 120, 120).\n",
      "Prediction batch: 100%|██████████████████████████████| 30/30 [00:00<00:00, 95.71it/s]\n",
      "INFO:root:Completed prediction. Now manipulating result before returning.\n",
      "INFO:root:Saving data of shape (120, 120, 120, 3) to /tmp/tmpyockcb_v/pred_0_ZY_270.h5 with kwargs {}.\n",
      "INFO:root:Saving data of shape (120, 120, 120) to /tmp/tmpyockcb_v/pred_0_ZY_labels_270.h5 with kwargs {}.\n",
      "INFO:root:NN1 prediction, complete.\n",
      "INFO:root:all_pred_pd\n",
      "INFO:root:            pred_data_probs_filenames   \n",
      "0     /tmp/tmpyockcb_v/pred_0_YX_0.h5  \\\n",
      "1     /tmp/tmpyockcb_v/pred_0_ZX_0.h5   \n",
      "2     /tmp/tmpyockcb_v/pred_0_ZY_0.h5   \n",
      "3    /tmp/tmpyockcb_v/pred_0_YX_90.h5   \n",
      "4    /tmp/tmpyockcb_v/pred_0_ZX_90.h5   \n",
      "5    /tmp/tmpyockcb_v/pred_0_ZY_90.h5   \n",
      "6   /tmp/tmpyockcb_v/pred_0_YX_180.h5   \n",
      "7   /tmp/tmpyockcb_v/pred_0_ZX_180.h5   \n",
      "8   /tmp/tmpyockcb_v/pred_0_ZY_180.h5   \n",
      "9   /tmp/tmpyockcb_v/pred_0_YX_270.h5   \n",
      "10  /tmp/tmpyockcb_v/pred_0_ZX_270.h5   \n",
      "11  /tmp/tmpyockcb_v/pred_0_ZY_270.h5   \n",
      "\n",
      "                  pred_data_labels_filenames  pred_sets pred_planes   \n",
      "0     /tmp/tmpyockcb_v/pred_0_YX_labels_0.h5          0          YX  \\\n",
      "1     /tmp/tmpyockcb_v/pred_0_ZX_labels_0.h5          0          ZX   \n",
      "2     /tmp/tmpyockcb_v/pred_0_ZY_labels_0.h5          0          ZY   \n",
      "3    /tmp/tmpyockcb_v/pred_0_YX_labels_90.h5          0          YX   \n",
      "4    /tmp/tmpyockcb_v/pred_0_ZX_labels_90.h5          0          ZX   \n",
      "5    /tmp/tmpyockcb_v/pred_0_ZY_labels_90.h5          0          ZY   \n",
      "6   /tmp/tmpyockcb_v/pred_0_YX_labels_180.h5          0          YX   \n",
      "7   /tmp/tmpyockcb_v/pred_0_ZX_labels_180.h5          0          ZX   \n",
      "8   /tmp/tmpyockcb_v/pred_0_ZY_labels_180.h5          0          ZY   \n",
      "9   /tmp/tmpyockcb_v/pred_0_YX_labels_270.h5          0          YX   \n",
      "10  /tmp/tmpyockcb_v/pred_0_ZX_labels_270.h5          0          ZX   \n",
      "11  /tmp/tmpyockcb_v/pred_0_ZY_labels_270.h5          0          ZY   \n",
      "\n",
      "    pred_rots  pred_ipred      pred_shapes  \n",
      "0           0           0  (120, 120, 120)  \n",
      "1           0           1  (120, 120, 120)  \n",
      "2           0           2  (120, 120, 120)  \n",
      "3          90           3  (120, 120, 120)  \n",
      "4          90           4  (120, 120, 120)  \n",
      "5          90           5  (120, 120, 120)  \n",
      "6         180           6  (120, 120, 120)  \n",
      "7         180           7  (120, 120, 120)  \n",
      "8         180           8  (120, 120, 120)  \n",
      "9         270           9  (120, 120, 120)  \n",
      "10        270          10  (120, 120, 120)  \n",
      "11        270          11  (120, 120, 120)  \n",
      "INFO:root:Building large object containing all predictions.\n",
      "INFO:root:use_dask=False. Will try to aggregate data to a numpy.ndarray\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:data0.shape:(120, 120, 120, 3)\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]\n",
      "INFO:root:Allocation using numpy failed. Failsafe will use dask.\n",
      "INFO:root:Exception type:<class 'AttributeError'>\n",
      "INFO:root:use_dask=True. Will aggregate data to a dask.array object\n",
      "  0%|          | 0/12 [00:00<?, ?it/s]INFO:root:i:0, data0.shape:(120, 120, 120, 3), data0.chunksize:(120, 120, 120, 3) \n",
      "INFO:root:npredictions:12\n",
      "INFO:root:data_all shape:(12, 120, 120, 120, 3) chunks_shape:(12, 120, 120, 120, 3)\n",
      "100%|██████████| 12/12 [00:00<00:00, 512.89it/s]\n",
      "INFO:root:Setting up NN2 prediction\n",
      "INFO:root:Data type is dask.core.Array\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[########################################] | 100% Completed | 2.43 sms\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:NN2 prediction complete.\n",
      "INFO:root:BLOCK: This block's calculation completed\n",
      "INFO:root:BLOCK:Crop block result from origin jz0,jy0,jx0 = : 20,32,10\n",
      "INFO:root:BLOCK:Copying cropped block to datares\n",
      "INFO:root:BLOCK: Completed. Results should be in datares\n"
     ]
    }
   ],
   "source": [
    "pred_labels_block = lgu.map_vol_function_by_blocking(lgsegmentor0.predict, data_to_pred, (120,120,120),(20,32,10))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<Labels layer 'pred_labels_block' at 0x7ff9ec5c3fa0>"
      ]
     },
     "execution_count": 14,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import napari\n",
    "NV=napari.Viewer()\n",
    "NV.add_image(data_to_pred)\n",
    "NV.add_labels(labels_to_compare)\n",
    "NV.add_labels(pred_labels, color={1:'green'})\n",
    "NV.add_labels(pred_labels_block, color={1:'red'})"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Prediction with blocking algorithm is worse from the calculation without blocking so be careful when using it. Thre are other instances where it may work better"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Compare \"block\"-prediction with ground truth"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:MetricScoreOfVols_Dice()\n",
      "INFO:root:Number of class segmentations in first volume 3\n",
      "INFO:root:Number of class segmentations in second volume 3\n",
      "INFO:root:Calculating using numpy\n",
      "INFO:root:dicescores = {1: 0.5114902042615816, 2: 0.4111010845463054}\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "(0.46129564440394355, {1: 0.5114902042615816, 2: 0.4111010845463054})"
      ]
     },
     "execution_count": 15,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "lgm.MetricScoreOfVols_Dice(pred_labels_block,labels_to_compare)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Compare \"block\"-prediction with whole prediction"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:MetricScoreOfVols_Dice()\n",
      "INFO:root:Number of class segmentations in first volume 3\n",
      "INFO:root:Number of class segmentations in second volume 3\n",
      "INFO:root:Calculating using numpy\n",
      "INFO:root:dicescores = {1: 0.9030428830255378, 2: 0.762003403950374}\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "(0.8325231434879559, {1: 0.9030428830255378, 2: 0.762003403950374})"
      ]
     },
     "execution_count": 16,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "lgm.MetricScoreOfVols_Dice(pred_labels_block,pred_labels)"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.9.18"
  },
  "orig_nbformat": 4
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
